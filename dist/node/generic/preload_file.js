var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var file = require('../core/file');
var api_error_1 = require('../core/api_error');
var fs = require('../core/node_fs');
var PreloadFile = (function (_super) {
    __extends(PreloadFile, _super);
    function PreloadFile(_fs, _path, _flag, _stat, contents) {
        _super.call(this);
        this._pos = 0;
        this._dirty = false;
        this._fs = _fs;
        this._path = _path;
        this._flag = _flag;
        this._stat = _stat;
        if (contents != null) {
            this._buffer = contents;
        }
        else {
            this._buffer = new Buffer(0);
        }
        if (this._stat.size !== this._buffer.length && this._flag.isReadable()) {
            throw new Error("Invalid buffer: Buffer is " + this._buffer.length + " long, yet Stats object specifies that file is " + this._stat.size + " long.");
        }
    }
    PreloadFile.prototype.isDirty = function () {
        return this._dirty;
    };
    PreloadFile.prototype.resetDirty = function () {
        this._dirty = false;
    };
    PreloadFile.prototype.getBuffer = function () {
        return this._buffer;
    };
    PreloadFile.prototype.getStats = function () {
        return this._stat;
    };
    PreloadFile.prototype.getFlag = function () {
        return this._flag;
    };
    PreloadFile.prototype.getPath = function () {
        return this._path;
    };
    PreloadFile.prototype.getPos = function () {
        if (this._flag.isAppendable()) {
            return this._stat.size;
        }
        return this._pos;
    };
    PreloadFile.prototype.advancePos = function (delta) {
        return this._pos += delta;
    };
    PreloadFile.prototype.setPos = function (newPos) {
        return this._pos = newPos;
    };
    PreloadFile.prototype.sync = function (cb) {
        try {
            this.syncSync();
            cb();
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.syncSync = function () {
        throw new api_error_1.ApiError(api_error_1.ErrorCode.ENOTSUP);
    };
    PreloadFile.prototype.close = function (cb) {
        try {
            this.closeSync();
            cb();
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.closeSync = function () {
        throw new api_error_1.ApiError(api_error_1.ErrorCode.ENOTSUP);
    };
    PreloadFile.prototype.stat = function (cb) {
        try {
            cb(null, this._stat.clone());
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.statSync = function () {
        return this._stat.clone();
    };
    PreloadFile.prototype.truncate = function (len, cb) {
        try {
            this.truncateSync(len);
            if (this._flag.isSynchronous() && !fs.getRootFS().supportsSynch()) {
                this.sync(cb);
            }
            cb();
        }
        catch (e) {
            return cb(e);
        }
    };
    PreloadFile.prototype.truncateSync = function (len) {
        this._dirty = true;
        if (!this._flag.isWriteable()) {
            throw new api_error_1.ApiError(api_error_1.ErrorCode.EPERM, 'File not opened with a writeable mode.');
        }
        this._stat.mtime = new Date();
        if (len > this._buffer.length) {
            var buf = new Buffer(len - this._buffer.length);
            buf.fill(0);
            this.writeSync(buf, 0, buf.length, this._buffer.length);
            if (this._flag.isSynchronous() && fs.getRootFS().supportsSynch()) {
                this.syncSync();
            }
            return;
        }
        this._stat.size = len;
        var newBuff = new Buffer(len);
        this._buffer.copy(newBuff, 0, 0, len);
        this._buffer = newBuff;
        if (this._flag.isSynchronous() && fs.getRootFS().supportsSynch()) {
            this.syncSync();
        }
    };
    PreloadFile.prototype.write = function (buffer, offset, length, position, cb) {
        try {
            cb(null, this.writeSync(buffer, offset, length, position), buffer);
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.writeSync = function (buffer, offset, length, position) {
        this._dirty = true;
        if (position == null) {
            position = this.getPos();
        }
        if (!this._flag.isWriteable()) {
            throw new api_error_1.ApiError(api_error_1.ErrorCode.EPERM, 'File not opened with a writeable mode.');
        }
        var endFp = position + length;
        if (endFp > this._stat.size) {
            this._stat.size = endFp;
            if (endFp > this._buffer.length) {
                var newBuff = new Buffer(endFp);
                this._buffer.copy(newBuff);
                this._buffer = newBuff;
            }
        }
        var len = buffer.copy(this._buffer, position, offset, offset + length);
        this._stat.mtime = new Date();
        if (this._flag.isSynchronous()) {
            this.syncSync();
            return len;
        }
        this.setPos(position + len);
        return len;
    };
    PreloadFile.prototype.read = function (buffer, offset, length, position, cb) {
        try {
            cb(null, this.readSync(buffer, offset, length, position), buffer);
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.readSync = function (buffer, offset, length, position) {
        if (!this._flag.isReadable()) {
            throw new api_error_1.ApiError(api_error_1.ErrorCode.EPERM, 'File not opened with a readable mode.');
        }
        if (position == null) {
            position = this.getPos();
        }
        var endRead = position + length;
        if (endRead > this._stat.size) {
            length = this._stat.size - position;
        }
        var rv = this._buffer.copy(buffer, offset, position, position + length);
        this._stat.atime = new Date();
        this._pos = position + length;
        return rv;
    };
    PreloadFile.prototype.chmod = function (mode, cb) {
        try {
            this.chmodSync(mode);
            cb();
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.chmodSync = function (mode) {
        if (!this._fs.supportsProps()) {
            throw new api_error_1.ApiError(api_error_1.ErrorCode.ENOTSUP);
        }
        this._dirty = true;
        this._stat.chmod(mode);
        this.syncSync();
    };
    return PreloadFile;
})(file.BaseFile);
exports.PreloadFile = PreloadFile;
var NoSyncFile = (function (_super) {
    __extends(NoSyncFile, _super);
    function NoSyncFile(_fs, _path, _flag, _stat, contents) {
        _super.call(this, _fs, _path, _flag, _stat, contents);
    }
    NoSyncFile.prototype.sync = function (cb) {
        cb();
    };
    NoSyncFile.prototype.syncSync = function () { };
    NoSyncFile.prototype.close = function (cb) {
        cb();
    };
    NoSyncFile.prototype.closeSync = function () { };
    return NoSyncFile;
})(PreloadFile);
exports.NoSyncFile = NoSyncFile;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlbG9hZF9maWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2dlbmVyaWMvcHJlbG9hZF9maWxlLnRzIl0sIm5hbWVzIjpbIlByZWxvYWRGaWxlIiwiUHJlbG9hZEZpbGUuY29uc3RydWN0b3IiLCJQcmVsb2FkRmlsZS5pc0RpcnR5IiwiUHJlbG9hZEZpbGUucmVzZXREaXJ0eSIsIlByZWxvYWRGaWxlLmdldEJ1ZmZlciIsIlByZWxvYWRGaWxlLmdldFN0YXRzIiwiUHJlbG9hZEZpbGUuZ2V0RmxhZyIsIlByZWxvYWRGaWxlLmdldFBhdGgiLCJQcmVsb2FkRmlsZS5nZXRQb3MiLCJQcmVsb2FkRmlsZS5hZHZhbmNlUG9zIiwiUHJlbG9hZEZpbGUuc2V0UG9zIiwiUHJlbG9hZEZpbGUuc3luYyIsIlByZWxvYWRGaWxlLnN5bmNTeW5jIiwiUHJlbG9hZEZpbGUuY2xvc2UiLCJQcmVsb2FkRmlsZS5jbG9zZVN5bmMiLCJQcmVsb2FkRmlsZS5zdGF0IiwiUHJlbG9hZEZpbGUuc3RhdFN5bmMiLCJQcmVsb2FkRmlsZS50cnVuY2F0ZSIsIlByZWxvYWRGaWxlLnRydW5jYXRlU3luYyIsIlByZWxvYWRGaWxlLndyaXRlIiwiUHJlbG9hZEZpbGUud3JpdGVTeW5jIiwiUHJlbG9hZEZpbGUucmVhZCIsIlByZWxvYWRGaWxlLnJlYWRTeW5jIiwiUHJlbG9hZEZpbGUuY2htb2QiLCJQcmVsb2FkRmlsZS5jaG1vZFN5bmMiLCJOb1N5bmNGaWxlIiwiTm9TeW5jRmlsZS5jb25zdHJ1Y3RvciIsIk5vU3luY0ZpbGUuc3luYyIsIk5vU3luY0ZpbGUuc3luY1N5bmMiLCJOb1N5bmNGaWxlLmNsb3NlIiwiTm9TeW5jRmlsZS5jbG9zZVN5bmMiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBTyxJQUFJLFdBQVcsY0FBYyxDQUFDLENBQUM7QUFJdEMsMEJBQWtDLG1CQUFtQixDQUFDLENBQUE7QUFDdEQsSUFBTyxFQUFFLFdBQVcsaUJBQWlCLENB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QUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM5QkEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDaERBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRVpBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQ3hEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxhQUFhQSxFQUFFQSxJQUFJQSxFQUFFQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQSxhQUFhQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDakVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO1lBQ2xCQSxDQUFDQTtZQUNEQSxNQUFNQSxDQUFDQTtRQUNUQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUV0QkEsSUFBSUEsT0FBT0EsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDOUJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3RDQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUN2QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsYUFBYUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0EsYUFBYUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDakVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO1FBQ2xCQSxDQUFDQTtJQUNIQSxDQUFDQTtJQWdCTWxCLDJCQUFLQSxHQUFaQSxVQUFhQSxNQUFrQkEsRUFBRUEsTUFBY0EsRUFBRUEsTUFBY0EsRUFBRUEsUUFBZ0JBLEVBQUVBLEVBQTBEQTtRQUMzSW1CLElBQUlBLENBQUNBO1lBQ0hBLEVBQUVBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLE1BQU1BLEVBQUVBLE1BQU1BLEVBQUVBLE1BQU1BLEVBQUVBLFFBQVFBLENBQUNBLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBO1FBQ3JFQSxDQUFFQTtRQUFBQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNYQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNSQSxDQUFDQTtJQUNIQSxDQUFDQTtJQWVNbkIsK0JBQVNBLEdBQWhCQSxVQUFpQkEsTUFBa0JBLEVBQUVBLE1BQWNBLEVBQUVBLE1BQWNBLEVBQUVBLFFBQWdCQTtRQUNuRm9CLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO1FBQ25CQSxFQUFFQSxDQUFDQSxDQUFDQSxRQUFRQSxJQUFJQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNyQkEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsQ0FBQ0E7UUFDM0JBLENBQUNBO1FBQ0RBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLFdBQVdBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQzlCQSxNQUFNQSxJQUFJQSxvQkFBUUEsQ0FBQ0EscUJBQVNBLENBQUNBLEtBQUtBLEVBQUVBLHdDQUF3Q0EsQ0FBQ0EsQ0FBQ0E7UUFDaEZBLENBQUNBO1FBQ0RBLElBQUlBLEtBQUtBLEdBQUdBLFFBQVFBLEdBQUdBLE1BQU1BLENBQUNBO1FBQzlCQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM1QkEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsR0FBR0EsS0FBS0EsQ0FBQ0E7WUFDeEJBLEVBQUVBLENBQUNBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO2dCQUVoQ0EsSUFBSUEsT0FBT0EsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2hDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxDQUFDQTtnQkFDM0JBLElBQUlBLENBQUNBLE9BQU9BLEdBQUdBLE9BQU9BLENBQUNBO1lBQ3pCQSxDQUFDQTtRQUNIQSxDQUFDQTtRQUNEQSxJQUFJQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxRQUFRQSxFQUFFQSxNQUFNQSxFQUFFQSxNQUFNQSxHQUFHQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN2RUEsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsS0FBS0EsR0FBR0EsSUFBSUEsSUFBSUEsRUFBRUEsQ0FBQ0E7UUFDOUJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLGFBQWFBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQy9CQSxJQUFJQSxDQUFDQSxRQUFRQSxFQUFFQSxDQUFDQTtZQUNoQkEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7UUFDYkEsQ0FBQ0E7UUFDREEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsR0FBR0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDNUJBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBO0lBQ2JBLENBQUNBO0lBZU1wQiwwQkFBSUEsR0FBWEEsVUFBWUEsTUFBa0JBLEVBQUVBLE1BQWNBLEVBQUVBLE1BQWNBLEVBQUVBLFFBQWdCQSxFQUFFQSxFQUEwREE7UUFDMUlxQixJQUFJQSxDQUFDQTtZQUNIQSxFQUFFQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxRQUFRQSxDQUFDQSxNQUFNQSxFQUFFQSxNQUFNQSxFQUFFQSxNQUFNQSxFQUFFQSxRQUFRQSxDQUFDQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUNwRUEsQ0FBRUE7UUFBQUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUkEsQ0FBQ0E7SUFDSEEsQ0FBQ0E7SUFjTXJCLDhCQUFRQSxHQUFmQSxVQUFnQkEsTUFBa0JBLEVBQUVBLE1BQWNBLEVBQUVBLE1BQWNBLEVBQUVBLFFBQWdCQTtRQUNsRnNCLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLFVBQVVBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1lBQzdCQSxNQUFNQSxJQUFJQSxvQkFBUUEsQ0FBQ0EscUJBQVNBLENBQUNBLEtBQUtBLEVBQUVBLHVDQUF1Q0EsQ0FBQ0EsQ0FBQ0E7UUFDL0VBLENBQUNBO1FBQ0RBLEVBQUVBLENBQUNBLENBQUNBLFFBQVFBLElBQUlBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQ3JCQSxRQUFRQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxFQUFFQSxDQUFDQTtRQUMzQkEsQ0FBQ0E7UUFDREEsSUFBSUEsT0FBT0EsR0FBR0EsUUFBUUEsR0FBR0EsTUFBTUEsQ0FBQ0E7UUFDaENBLEVBQUVBLENBQUNBLENBQUNBLE9BQU9BLEdBQUdBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQzlCQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFHQSxRQUFRQSxDQUFDQTtRQUN0Q0EsQ0FBQ0E7UUFDREEsSUFBSUEsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsTUFBTUEsRUFBRUEsTUFBTUEsRUFBRUEsUUFBUUEsRUFBRUEsUUFBUUEsR0FBR0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDeEVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEtBQUtBLEdBQUdBLElBQUlBLElBQUlBLEVBQUVBLENBQUNBO1FBQzlCQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxRQUFRQSxHQUFHQSxNQUFNQSxDQUFDQTtRQUM5QkEsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7SUFDWkEsQ0FBQ0E7SUFPTXRCLDJCQUFLQSxHQUFaQSxVQUFhQSxJQUFZQSxFQUFFQSxFQUEwQkE7UUFDbkR1QixJQUFJQSxDQUFDQTtZQUNIQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNyQkEsRUFBRUEsRUFBRUEsQ0FBQ0E7UUFDUEEsQ0FBRUE7UUFBQUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDWEEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDUkEsQ0FBQ0E7SUFDSEEsQ0FBQ0E7SUFNTXZCLCtCQUFTQSxHQUFoQkEsVUFBaUJBLElBQVlBO1FBQzNCd0IsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsYUFBYUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDOUJBLE1BQU1BLElBQUlBLG9CQUFRQSxDQUFDQSxxQkFBU0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFDeENBLENBQUNBO1FBQ0RBLElBQUlBLENBQUNBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBO1FBQ25CQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUN2QkEsSUFBSUEsQ0FBQ0EsUUFBUUEsRUFBRUEsQ0FBQ0E7SUFDbEJBLENBQUNBO0lBQ0h4QixrQkFBQ0E7QUFBREEsQ0FBQ0EsQUF2V0QsRUFBbUUsSUFBSSxDQUFDLFFBQVEsRUF1Vy9FO0FBdldZLG1CQUFXLGNBdVd2QixDQUFBO0FBTUQ7SUFBa0V5Qiw4QkFBY0E7SUFDOUVBLG9CQUFZQSxHQUFNQSxFQUFFQSxLQUFhQSxFQUFFQSxLQUFlQSxFQUFFQSxLQUFZQSxFQUFFQSxRQUFxQkE7UUFDckZDLGtCQUFNQSxHQUFHQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQTtJQUM1Q0EsQ0FBQ0E7SUFLTUQseUJBQUlBLEdBQVhBLFVBQVlBLEVBQTBCQTtRQUNwQ0UsRUFBRUEsRUFBRUEsQ0FBQ0E7SUFDUEEsQ0FBQ0E7SUFJTUYsNkJBQVFBLEdBQWZBLGNBQXlCRyxDQUFDQTtJQUtuQkgsMEJBQUtBLEdBQVpBLFVBQWFBLEVBQTBCQTtRQUNyQ0ksRUFBRUEsRUFBRUEsQ0FBQ0E7SUFDUEEsQ0FBQ0E7SUFJTUosOEJBQVNBLEdBQWhCQSxjQUEwQkssQ0FBQ0E7SUFDN0JMLGlCQUFDQTtBQUFEQSxDQUFDQSxBQTFCRCxFQUFrRSxXQUFXLEVBMEI1RTtBQTFCWSxrQkFBVSxhQTBCdEIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmaWxlID0gcmVxdWlyZSgnLi4vY29yZS9maWxlJyk7XG5pbXBvcnQgZmlsZV9zeXN0ZW0gPSByZXF1aXJlKCcuLi9jb3JlL2ZpbGVfc3lzdGVtJyk7XG5pbXBvcnQgU3RhdHMgZnJvbSAnLi4vY29yZS9ub2RlX2ZzX3N0YXRzJztcbmltcG9ydCB7RmlsZUZsYWd9IGZyb20gJy4uL2NvcmUvZmlsZV9mbGFnJztcbmltcG9ydCB7QXBpRXJyb3IsIEVycm9yQ29kZX0gZnJvbSAnLi4vY29yZS9hcGlfZXJyb3InO1xuaW1wb3J0IGZzID0gcmVxdWlyZSgnLi4vY29yZS9ub2RlX2ZzJyk7XG5cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIEZpbGUgaW50ZXJmYWNlIHRoYXQgb3BlcmF0ZXMgb24gYSBmaWxlIHRoYXQgaXNcbiAqIGNvbXBsZXRlbHkgaW4tbWVtb3J5LiBQcmVsb2FkRmlsZXMgYXJlIGJhY2tlZCBieSBhIEJ1ZmZlci5cbiAqXG4gKiBUaGlzIGlzIGFsc28gYW4gYWJzdHJhY3QgY2xhc3MsIGFzIGl0IGxhY2tzIGFuIGltcGxlbWVudGF0aW9uIG9mICdzeW5jJyBhbmRcbiAqICdjbG9zZScuIEVhY2ggZmlsZXN5c3RlbSB0aGF0IHdpc2hlcyB0byB1c2UgdGhpcyBmaWxlIHJlcHJlc2VudGF0aW9uIG11c3RcbiAqIGV4dGVuZCB0aGlzIGNsYXNzIGFuZCBpbXBsZW1lbnQgdGhvc2UgdHdvIG1ldGhvZHMuXG4gKiBAdG9kbyAnY2xvc2UnIGxldmVyIHRoYXQgZGlzYWJsZXMgZnVuY3Rpb25hbGl0eSBvbmNlIGNsb3NlZC5cbiAqL1xuZXhwb3J0IGNsYXNzIFByZWxvYWRGaWxlPFQgZXh0ZW5kcyBmaWxlX3N5c3RlbS5GaWxlU3lzdGVtPiBleHRlbmRzIGZpbGUuQmFzZUZpbGUge1xuICBwcml2YXRlIF9wb3M6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgX3BhdGg6IHN0cmluZztcbiAgcHJvdGVjdGVkIF9mczogVDtcbiAgcHJpdmF0ZSBfc3RhdDogU3RhdHM7XG4gIHByaXZhdGUgX2ZsYWc6IEZpbGVGbGFnO1xuICBwcml2YXRlIF9idWZmZXI6IE5vZGVCdWZmZXI7XG4gIHByaXZhdGUgX2RpcnR5OiBib29sZWFuID0gZmFsc2U7XG4gIC8qKlxuICAgKiBDcmVhdGVzIGEgZmlsZSB3aXRoIHRoZSBnaXZlbiBwYXRoIGFuZCwgb3B0aW9uYWxseSwgdGhlIGdpdmVuIGNvbnRlbnRzLiBOb3RlXG4gICAqIHRoYXQsIGlmIGNvbnRlbnRzIGlzIHNwZWNpZmllZCwgaXQgd2lsbCBiZSBtdXRhdGVkIGJ5IHRoZSBmaWxlIVxuICAgKiBAcGFyYW0gW0Jyb3dzZXJGUy5GaWxlU3lzdGVtXSBfZnMgVGhlIGZpbGUgc3lzdGVtIHRoYXQgY3JlYXRlZCB0aGUgZmlsZS5cbiAgICogQHBhcmFtIFtTdHJpbmddIF9wYXRoXG4gICAqIEBwYXJhbSBbQnJvd3NlckZTLkZpbGVNb2RlXSBfbW9kZSBUaGUgbW9kZSB0aGF0IHRoZSBmaWxlIHdhcyBvcGVuZWQgdXNpbmcuXG4gICAqICAgRGljdGF0ZXMgcGVybWlzc2lvbnMgYW5kIHdoZXJlIHRoZSBmaWxlIHBvaW50ZXIgc3RhcnRzLlxuICAgKiBAcGFyYW0gW0Jyb3dzZXJGUy5ub2RlLmZzLlN0YXRzXSBfc3RhdCBUaGUgc3RhdHMgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gZmlsZS5cbiAgICogICBQcmVsb2FkRmlsZSB3aWxsIG11dGF0ZSB0aGlzIG9iamVjdC4gTm90ZSB0aGF0IHRoaXMgb2JqZWN0IG11c3QgY29udGFpblxuICAgKiAgIHRoZSBhcHByb3ByaWF0ZSBtb2RlIHRoYXQgdGhlIGZpbGUgd2FzIG9wZW5lZCBhcy5cbiAgICogQHBhcmFtIFtCcm93c2VyRlMubm9kZS5CdWZmZXI/XSBjb250ZW50cyBBIGJ1ZmZlciBjb250YWluaW5nIHRoZSBlbnRpcmVcbiAgICogICBjb250ZW50cyBvZiB0aGUgZmlsZS4gUHJlbG9hZEZpbGUgd2lsbCBtdXRhdGUgdGhpcyBidWZmZXIuIElmIG5vdFxuICAgKiAgIHNwZWNpZmllZCwgd2UgYXNzdW1lIGl0IGlzIGEgbmV3IGZpbGUuXG4gICAqL1xuICBjb25zdHJ1Y3RvcihfZnM6IFQsIF9wYXRoOiBzdHJpbmcsIF9mbGFnOiBGaWxlRmxhZywgX3N0YXQ6IFN0YXRzLCBjb250ZW50cz86IE5vZGVCdWZmZXIpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuX2ZzID0gX2ZzO1xuICAgIHRoaXMuX3BhdGggPSBfcGF0aDtcbiAgICB0aGlzLl9mbGFnID0gX2ZsYWc7XG4gICAgdGhpcy5fc3RhdCA9IF9zdGF0O1xuICAgIGlmIChjb250ZW50cyAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9idWZmZXIgPSBjb250ZW50cztcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRW1wdHkgYnVmZmVyLiBJdCdsbCBleHBhbmQgb25jZSB3ZSB3cml0ZSBzdHVmZiB0byBpdC5cbiAgICAgIHRoaXMuX2J1ZmZlciA9IG5ldyBCdWZmZXIoMCk7XG4gICAgfVxuICAgIC8vIE5vdGU6IFRoaXMgaW52YXJpYW50IGlzICpub3QqIG1haW50YWluZWQgb25jZSB0aGUgZmlsZSBzdGFydHMgZ2V0dGluZ1xuICAgIC8vIG1vZGlmaWVkLlxuICAgIC8vIE5vdGU6IE9ubHkgYWN0dWFsbHkgbWF0dGVycyBpZiBmaWxlIGlzIHJlYWRhYmxlLCBhcyB3cml0ZWFibGUgbW9kZXMgbWF5XG4gICAgLy8gdHJ1bmNhdGUvYXBwZW5kIHRvIGZpbGUuXG4gICAgaWYgKHRoaXMuX3N0YXQuc2l6ZSAhPT0gdGhpcy5fYnVmZmVyLmxlbmd0aCAmJiB0aGlzLl9mbGFnLmlzUmVhZGFibGUoKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiSW52YWxpZCBidWZmZXI6IEJ1ZmZlciBpcyBcIiArIHRoaXMuX2J1ZmZlci5sZW5ndGggKyBcIiBsb25nLCB5ZXQgU3RhdHMgb2JqZWN0IHNwZWNpZmllcyB0aGF0IGZpbGUgaXMgXCIgKyB0aGlzLl9zdGF0LnNpemUgKyBcIiBsb25nLlwiKTtcbiAgICB9XG4gIH1cblxuICBwcm90ZWN0ZWQgaXNEaXJ0eSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdGhpcy5fZGlydHk7XG4gIH1cblxuICAvKipcbiAgICogUmVzZXRzIHRoZSBkaXJ0eSBiaXQuIFNob3VsZCBvbmx5IGJlIGNhbGxlZCBhZnRlciBhIHN5bmMgaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkuXG4gICAqL1xuICBwcm90ZWN0ZWQgcmVzZXREaXJ0eSgpIHtcbiAgICB0aGlzLl9kaXJ0eSA9IGZhbHNlO1xuICB9XG5cbiAgLyoqXG4gICAqIE5PTlNUQU5EQVJEOiBHZXQgdGhlIHVuZGVybHlpbmcgYnVmZmVyIGZvciB0aGlzIGZpbGUuICEhRE8gTk9UIE1VVEFURSEhIFdpbGwgbWVzcyB1cCBkaXJ0eSB0cmFja2luZy5cbiAgICovXG4gIHB1YmxpYyBnZXRCdWZmZXIoKTogTm9kZUJ1ZmZlciB7XG4gICAgcmV0dXJuIHRoaXMuX2J1ZmZlcjtcbiAgfVxuXG4gIC8qKlxuICAgKiBOT05TVEFOREFSRDogR2V0IHVuZGVybHlpbmcgc3RhdHMgZm9yIHRoaXMgZmlsZS4gISFETyBOT1QgTVVUQVRFISFcbiAgICovXG4gIHB1YmxpYyBnZXRTdGF0cygpOiBTdGF0cyB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXQ7XG4gIH1cblxuICBwdWJsaWMgZ2V0RmxhZygpOiBGaWxlRmxhZyB7XG4gICAgcmV0dXJuIHRoaXMuX2ZsYWc7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBwYXRoIHRvIHRoaXMgZmlsZS5cbiAgICogQHJldHVybiBbU3RyaW5nXSBUaGUgcGF0aCB0byB0aGUgZmlsZS5cbiAgICovXG4gIHB1YmxpYyBnZXRQYXRoKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuX3BhdGg7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBjdXJyZW50IGZpbGUgcG9zaXRpb24uXG4gICAqXG4gICAqIFdlIGVtdWxhdGUgdGhlIGZvbGxvd2luZyBidWcgbWVudGlvbmVkIGluIHRoZSBOb2RlIGRvY3VtZW50YXRpb246XG4gICAqID4gT24gTGludXgsIHBvc2l0aW9uYWwgd3JpdGVzIGRvbid0IHdvcmsgd2hlbiB0aGUgZmlsZSBpcyBvcGVuZWQgaW4gYXBwZW5kXG4gICAqICAgbW9kZS4gVGhlIGtlcm5lbCBpZ25vcmVzIHRoZSBwb3NpdGlvbiBhcmd1bWVudCBhbmQgYWx3YXlzIGFwcGVuZHMgdGhlIGRhdGFcbiAgICogICB0byB0aGUgZW5kIG9mIHRoZSBmaWxlLlxuICAgKiBAcmV0dXJuIFtOdW1iZXJdIFRoZSBjdXJyZW50IGZpbGUgcG9zaXRpb24uXG4gICAqL1xuICBwdWJsaWMgZ2V0UG9zKCk6IG51bWJlciB7XG4gICAgaWYgKHRoaXMuX2ZsYWcuaXNBcHBlbmRhYmxlKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9zdGF0LnNpemU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9wb3M7XG4gIH1cblxuICAvKipcbiAgICogQWR2YW5jZSB0aGUgY3VycmVudCBmaWxlIHBvc2l0aW9uIGJ5IHRoZSBpbmRpY2F0ZWQgbnVtYmVyIG9mIHBvc2l0aW9ucy5cbiAgICogQHBhcmFtIFtOdW1iZXJdIGRlbHRhXG4gICAqL1xuICBwdWJsaWMgYWR2YW5jZVBvcyhkZWx0YTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fcG9zICs9IGRlbHRhO1xuICB9XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgZmlsZSBwb3NpdGlvbi5cbiAgICogQHBhcmFtIFtOdW1iZXJdIG5ld1Bvc1xuICAgKi9cbiAgcHVibGljIHNldFBvcyhuZXdQb3M6IG51bWJlcik6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX3BvcyA9IG5ld1BvcztcbiAgfVxuXG4gIC8qKlxuICAgKiAqKkNvcmUqKjogQXN5bmNocm9ub3VzIHN5bmMuIE11c3QgYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2xhc3NlcyBvZiB0aGlzXG4gICAqIGNsYXNzLlxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvcildIGNiXG4gICAqL1xuICBwdWJsaWMgc3luYyhjYjogKGU/OiBBcGlFcnJvcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnN5bmNTeW5jKCk7XG4gICAgICBjYigpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNiKGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiAqKkNvcmUqKjogU3luY2hyb25vdXMgc3luYy5cbiAgICovXG4gIHB1YmxpYyBzeW5jU3luYygpOiB2b2lkIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoRXJyb3JDb2RlLkVOT1RTVVApO1xuICB9XG5cbiAgLyoqXG4gICAqICoqQ29yZSoqOiBBc3luY2hyb25vdXMgY2xvc2UuIE11c3QgYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2xhc3NlcyBvZiB0aGlzXG4gICAqIGNsYXNzLlxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvcildIGNiXG4gICAqL1xuICBwdWJsaWMgY2xvc2UoY2I6IChlPzogQXBpRXJyb3IpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5jbG9zZVN5bmMoKTtcbiAgICAgIGNiKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY2IoZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqICoqQ29yZSoqOiBTeW5jaHJvbm91cyBjbG9zZS5cbiAgICovXG4gIHB1YmxpYyBjbG9zZVN5bmMoKTogdm9pZCB7XG4gICAgdGhyb3cgbmV3IEFwaUVycm9yKEVycm9yQ29kZS5FTk9UU1VQKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3luY2hyb25vdXMgYHN0YXRgLlxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvciwgQnJvd3NlckZTLm5vZGUuZnMuU3RhdHMpXSBjYlxuICAgKi9cbiAgcHVibGljIHN0YXQoY2I6IChlOiBBcGlFcnJvciwgc3RhdD86IFN0YXRzKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGNiKG51bGwsIHRoaXMuX3N0YXQuY2xvbmUoKSk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY2IoZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN5bmNocm9ub3VzIGBzdGF0YC5cbiAgICovXG4gIHB1YmxpYyBzdGF0U3luYygpOiBTdGF0cyB7XG4gICAgcmV0dXJuIHRoaXMuX3N0YXQuY2xvbmUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3luY2hyb25vdXMgdHJ1bmNhdGUuXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBsZW5cbiAgICogQHBhcmFtIFtGdW5jdGlvbihCcm93c2VyRlMuQXBpRXJyb3IpXSBjYlxuICAgKi9cbiAgcHVibGljIHRydW5jYXRlKGxlbjogbnVtYmVyLCBjYjogKGU/OiBBcGlFcnJvcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLnRydW5jYXRlU3luYyhsZW4pO1xuICAgICAgaWYgKHRoaXMuX2ZsYWcuaXNTeW5jaHJvbm91cygpICYmICFmcy5nZXRSb290RlMoKS5zdXBwb3J0c1N5bmNoKCkpIHtcbiAgICAgICAgdGhpcy5zeW5jKGNiKTtcbiAgICAgIH1cbiAgICAgIGNiKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgcmV0dXJuIGNiKGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTeW5jaHJvbm91cyB0cnVuY2F0ZS5cbiAgICogQHBhcmFtIFtOdW1iZXJdIGxlblxuICAgKi9cbiAgcHVibGljIHRydW5jYXRlU3luYyhsZW46IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcbiAgICBpZiAoIXRoaXMuX2ZsYWcuaXNXcml0ZWFibGUoKSkge1xuICAgICAgdGhyb3cgbmV3IEFwaUVycm9yKEVycm9yQ29kZS5FUEVSTSwgJ0ZpbGUgbm90IG9wZW5lZCB3aXRoIGEgd3JpdGVhYmxlIG1vZGUuJyk7XG4gICAgfVxuICAgIHRoaXMuX3N0YXQubXRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIGlmIChsZW4gPiB0aGlzLl9idWZmZXIubGVuZ3RoKSB7XG4gICAgICB2YXIgYnVmID0gbmV3IEJ1ZmZlcihsZW4gLSB0aGlzLl9idWZmZXIubGVuZ3RoKTtcbiAgICAgIGJ1Zi5maWxsKDApO1xuICAgICAgLy8gV3JpdGUgd2lsbCBzZXQgQF9zdGF0LnNpemUgZm9yIHVzLlxuICAgICAgdGhpcy53cml0ZVN5bmMoYnVmLCAwLCBidWYubGVuZ3RoLCB0aGlzLl9idWZmZXIubGVuZ3RoKTtcbiAgICAgIGlmICh0aGlzLl9mbGFnLmlzU3luY2hyb25vdXMoKSAmJiBmcy5nZXRSb290RlMoKS5zdXBwb3J0c1N5bmNoKCkpIHtcbiAgICAgICAgdGhpcy5zeW5jU3luYygpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl9zdGF0LnNpemUgPSBsZW47XG4gICAgLy8gVHJ1bmNhdGUgYnVmZmVyIHRvICdsZW4nLlxuICAgIHZhciBuZXdCdWZmID0gbmV3IEJ1ZmZlcihsZW4pO1xuICAgIHRoaXMuX2J1ZmZlci5jb3B5KG5ld0J1ZmYsIDAsIDAsIGxlbik7XG4gICAgdGhpcy5fYnVmZmVyID0gbmV3QnVmZjtcbiAgICBpZiAodGhpcy5fZmxhZy5pc1N5bmNocm9ub3VzKCkgJiYgZnMuZ2V0Um9vdEZTKCkuc3VwcG9ydHNTeW5jaCgpKSB7XG4gICAgICB0aGlzLnN5bmNTeW5jKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFdyaXRlIGJ1ZmZlciB0byB0aGUgZmlsZS5cbiAgICogTm90ZSB0aGF0IGl0IGlzIHVuc2FmZSB0byB1c2UgZnMud3JpdGUgbXVsdGlwbGUgdGltZXMgb24gdGhlIHNhbWUgZmlsZVxuICAgKiB3aXRob3V0IHdhaXRpbmcgZm9yIHRoZSBjYWxsYmFjay5cbiAgICogQHBhcmFtIFtCcm93c2VyRlMubm9kZS5CdWZmZXJdIGJ1ZmZlciBCdWZmZXIgY29udGFpbmluZyB0aGUgZGF0YSB0byB3cml0ZSB0b1xuICAgKiAgdGhlIGZpbGUuXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBvZmZzZXQgT2Zmc2V0IGluIHRoZSBidWZmZXIgdG8gc3RhcnQgcmVhZGluZyBkYXRhIGZyb20uXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBsZW5ndGggVGhlIGFtb3VudCBvZiBieXRlcyB0byB3cml0ZSB0byB0aGUgZmlsZS5cbiAgICogQHBhcmFtIFtOdW1iZXJdIHBvc2l0aW9uIE9mZnNldCBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGZpbGUgd2hlcmUgdGhpc1xuICAgKiAgIGRhdGEgc2hvdWxkIGJlIHdyaXR0ZW4uIElmIHBvc2l0aW9uIGlzIG51bGwsIHRoZSBkYXRhIHdpbGwgYmUgd3JpdHRlbiBhdFxuICAgKiAgIHRoZSBjdXJyZW50IHBvc2l0aW9uLlxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvciwgTnVtYmVyLCBCcm93c2VyRlMubm9kZS5CdWZmZXIpXVxuICAgKiAgIGNiIFRoZSBudW1iZXIgc3BlY2lmaWVzIHRoZSBudW1iZXIgb2YgYnl0ZXMgd3JpdHRlbiBpbnRvIHRoZSBmaWxlLlxuICAgKi9cbiAgcHVibGljIHdyaXRlKGJ1ZmZlcjogTm9kZUJ1ZmZlciwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyLCBjYjogKGU6IEFwaUVycm9yLCBsZW4/OiBudW1iZXIsIGJ1ZmY/OiBOb2RlQnVmZmVyKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGNiKG51bGwsIHRoaXMud3JpdGVTeW5jKGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKSwgYnVmZmVyKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjYihlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV3JpdGUgYnVmZmVyIHRvIHRoZSBmaWxlLlxuICAgKiBOb3RlIHRoYXQgaXQgaXMgdW5zYWZlIHRvIHVzZSBmcy53cml0ZVN5bmMgbXVsdGlwbGUgdGltZXMgb24gdGhlIHNhbWUgZmlsZVxuICAgKiB3aXRob3V0IHdhaXRpbmcgZm9yIHRoZSBjYWxsYmFjay5cbiAgICogQHBhcmFtIFtCcm93c2VyRlMubm9kZS5CdWZmZXJdIGJ1ZmZlciBCdWZmZXIgY29udGFpbmluZyB0aGUgZGF0YSB0byB3cml0ZSB0b1xuICAgKiAgdGhlIGZpbGUuXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBvZmZzZXQgT2Zmc2V0IGluIHRoZSBidWZmZXIgdG8gc3RhcnQgcmVhZGluZyBkYXRhIGZyb20uXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBsZW5ndGggVGhlIGFtb3VudCBvZiBieXRlcyB0byB3cml0ZSB0byB0aGUgZmlsZS5cbiAgICogQHBhcmFtIFtOdW1iZXJdIHBvc2l0aW9uIE9mZnNldCBmcm9tIHRoZSBiZWdpbm5pbmcgb2YgdGhlIGZpbGUgd2hlcmUgdGhpc1xuICAgKiAgIGRhdGEgc2hvdWxkIGJlIHdyaXR0ZW4uIElmIHBvc2l0aW9uIGlzIG51bGwsIHRoZSBkYXRhIHdpbGwgYmUgd3JpdHRlbiBhdFxuICAgKiAgIHRoZSBjdXJyZW50IHBvc2l0aW9uLlxuICAgKiBAcmV0dXJuIFtOdW1iZXJdXG4gICAqL1xuICBwdWJsaWMgd3JpdGVTeW5jKGJ1ZmZlcjogTm9kZUJ1ZmZlciwgb2Zmc2V0OiBudW1iZXIsIGxlbmd0aDogbnVtYmVyLCBwb3NpdGlvbjogbnVtYmVyKTogbnVtYmVyIHtcbiAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XG4gICAgaWYgKHBvc2l0aW9uID09IG51bGwpIHtcbiAgICAgIHBvc2l0aW9uID0gdGhpcy5nZXRQb3MoKTtcbiAgICB9XG4gICAgaWYgKCF0aGlzLl9mbGFnLmlzV3JpdGVhYmxlKCkpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcihFcnJvckNvZGUuRVBFUk0sICdGaWxlIG5vdCBvcGVuZWQgd2l0aCBhIHdyaXRlYWJsZSBtb2RlLicpO1xuICAgIH1cbiAgICB2YXIgZW5kRnAgPSBwb3NpdGlvbiArIGxlbmd0aDtcbiAgICBpZiAoZW5kRnAgPiB0aGlzLl9zdGF0LnNpemUpIHtcbiAgICAgIHRoaXMuX3N0YXQuc2l6ZSA9IGVuZEZwO1xuICAgICAgaWYgKGVuZEZwID4gdGhpcy5fYnVmZmVyLmxlbmd0aCkge1xuICAgICAgICAvLyBFeHRlbmQgdGhlIGJ1ZmZlciFcbiAgICAgICAgdmFyIG5ld0J1ZmYgPSBuZXcgQnVmZmVyKGVuZEZwKTtcbiAgICAgICAgdGhpcy5fYnVmZmVyLmNvcHkobmV3QnVmZik7XG4gICAgICAgIHRoaXMuX2J1ZmZlciA9IG5ld0J1ZmY7XG4gICAgICB9XG4gICAgfVxuICAgIHZhciBsZW4gPSBidWZmZXIuY29weSh0aGlzLl9idWZmZXIsIHBvc2l0aW9uLCBvZmZzZXQsIG9mZnNldCArIGxlbmd0aCk7XG4gICAgdGhpcy5fc3RhdC5tdGltZSA9IG5ldyBEYXRlKCk7XG4gICAgaWYgKHRoaXMuX2ZsYWcuaXNTeW5jaHJvbm91cygpKSB7XG4gICAgICB0aGlzLnN5bmNTeW5jKCk7XG4gICAgICByZXR1cm4gbGVuO1xuICAgIH1cbiAgICB0aGlzLnNldFBvcyhwb3NpdGlvbiArIGxlbik7XG4gICAgcmV0dXJuIGxlbjtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZWFkIGRhdGEgZnJvbSB0aGUgZmlsZS5cbiAgICogQHBhcmFtIFtCcm93c2VyRlMubm9kZS5CdWZmZXJdIGJ1ZmZlciBUaGUgYnVmZmVyIHRoYXQgdGhlIGRhdGEgd2lsbCBiZVxuICAgKiAgIHdyaXR0ZW4gdG8uXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBvZmZzZXQgVGhlIG9mZnNldCB3aXRoaW4gdGhlIGJ1ZmZlciB3aGVyZSB3cml0aW5nIHdpbGxcbiAgICogICBzdGFydC5cbiAgICogQHBhcmFtIFtOdW1iZXJdIGxlbmd0aCBBbiBpbnRlZ2VyIHNwZWNpZnlpbmcgdGhlIG51bWJlciBvZiBieXRlcyB0byByZWFkLlxuICAgKiBAcGFyYW0gW051bWJlcl0gcG9zaXRpb24gQW4gaW50ZWdlciBzcGVjaWZ5aW5nIHdoZXJlIHRvIGJlZ2luIHJlYWRpbmcgZnJvbVxuICAgKiAgIGluIHRoZSBmaWxlLiBJZiBwb3NpdGlvbiBpcyBudWxsLCBkYXRhIHdpbGwgYmUgcmVhZCBmcm9tIHRoZSBjdXJyZW50IGZpbGVcbiAgICogICBwb3NpdGlvbi5cbiAgICogQHBhcmFtIFtGdW5jdGlvbihCcm93c2VyRlMuQXBpRXJyb3IsIE51bWJlciwgQnJvd3NlckZTLm5vZGUuQnVmZmVyKV0gY2IgVGhlXG4gICAqICAgbnVtYmVyIGlzIHRoZSBudW1iZXIgb2YgYnl0ZXMgcmVhZFxuICAgKi9cbiAgcHVibGljIHJlYWQoYnVmZmVyOiBOb2RlQnVmZmVyLCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXIsIGNiOiAoZTogQXBpRXJyb3IsIGxlbj86IG51bWJlciwgYnVmZj86IE5vZGVCdWZmZXIpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY2IobnVsbCwgdGhpcy5yZWFkU3luYyhidWZmZXIsIG9mZnNldCwgbGVuZ3RoLCBwb3NpdGlvbiksIGJ1ZmZlcik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY2IoZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlYWQgZGF0YSBmcm9tIHRoZSBmaWxlLlxuICAgKiBAcGFyYW0gW0Jyb3dzZXJGUy5ub2RlLkJ1ZmZlcl0gYnVmZmVyIFRoZSBidWZmZXIgdGhhdCB0aGUgZGF0YSB3aWxsIGJlXG4gICAqICAgd3JpdHRlbiB0by5cbiAgICogQHBhcmFtIFtOdW1iZXJdIG9mZnNldCBUaGUgb2Zmc2V0IHdpdGhpbiB0aGUgYnVmZmVyIHdoZXJlIHdyaXRpbmcgd2lsbFxuICAgKiAgIHN0YXJ0LlxuICAgKiBAcGFyYW0gW051bWJlcl0gbGVuZ3RoIEFuIGludGVnZXIgc3BlY2lmeWluZyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHRvIHJlYWQuXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBwb3NpdGlvbiBBbiBpbnRlZ2VyIHNwZWNpZnlpbmcgd2hlcmUgdG8gYmVnaW4gcmVhZGluZyBmcm9tXG4gICAqICAgaW4gdGhlIGZpbGUuIElmIHBvc2l0aW9uIGlzIG51bGwsIGRhdGEgd2lsbCBiZSByZWFkIGZyb20gdGhlIGN1cnJlbnQgZmlsZVxuICAgKiAgIHBvc2l0aW9uLlxuICAgKiBAcmV0dXJuIFtOdW1iZXJdXG4gICAqL1xuICBwdWJsaWMgcmVhZFN5bmMoYnVmZmVyOiBOb2RlQnVmZmVyLCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGlmICghdGhpcy5fZmxhZy5pc1JlYWRhYmxlKCkpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcihFcnJvckNvZGUuRVBFUk0sICdGaWxlIG5vdCBvcGVuZWQgd2l0aCBhIHJlYWRhYmxlIG1vZGUuJyk7XG4gICAgfVxuICAgIGlmIChwb3NpdGlvbiA9PSBudWxsKSB7XG4gICAgICBwb3NpdGlvbiA9IHRoaXMuZ2V0UG9zKCk7XG4gICAgfVxuICAgIHZhciBlbmRSZWFkID0gcG9zaXRpb24gKyBsZW5ndGg7XG4gICAgaWYgKGVuZFJlYWQgPiB0aGlzLl9zdGF0LnNpemUpIHtcbiAgICAgIGxlbmd0aCA9IHRoaXMuX3N0YXQuc2l6ZSAtIHBvc2l0aW9uO1xuICAgIH1cbiAgICB2YXIgcnYgPSB0aGlzLl9idWZmZXIuY29weShidWZmZXIsIG9mZnNldCwgcG9zaXRpb24sIHBvc2l0aW9uICsgbGVuZ3RoKTtcbiAgICB0aGlzLl9zdGF0LmF0aW1lID0gbmV3IERhdGUoKTtcbiAgICB0aGlzLl9wb3MgPSBwb3NpdGlvbiArIGxlbmd0aDtcbiAgICByZXR1cm4gcnY7XG4gIH1cblxuICAvKipcbiAgICogQXN5bmNocm9ub3VzIGBmY2htb2RgLlxuICAgKiBAcGFyYW0gW051bWJlcnxTdHJpbmddIG1vZGVcbiAgICogQHBhcmFtIFtGdW5jdGlvbihCcm93c2VyRlMuQXBpRXJyb3IpXSBjYlxuICAgKi9cbiAgcHVibGljIGNobW9kKG1vZGU6IG51bWJlciwgY2I6IChlPzogQXBpRXJyb3IpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgdGhpcy5jaG1vZFN5bmMobW9kZSk7XG4gICAgICBjYigpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNiKGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBc3luY2hyb25vdXMgYGZjaG1vZGAuXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBtb2RlXG4gICAqL1xuICBwdWJsaWMgY2htb2RTeW5jKG1vZGU6IG51bWJlcik6IHZvaWQge1xuICAgIGlmICghdGhpcy5fZnMuc3VwcG9ydHNQcm9wcygpKSB7XG4gICAgICB0aHJvdyBuZXcgQXBpRXJyb3IoRXJyb3JDb2RlLkVOT1RTVVApO1xuICAgIH1cbiAgICB0aGlzLl9kaXJ0eSA9IHRydWU7XG4gICAgdGhpcy5fc3RhdC5jaG1vZChtb2RlKTtcbiAgICB0aGlzLnN5bmNTeW5jKCk7XG4gIH1cbn1cblxuLyoqXG4gKiBGaWxlIGNsYXNzIGZvciB0aGUgSW5NZW1vcnkgYW5kIFhIUiBmaWxlIHN5c3RlbXMuXG4gKiBEb2Vzbid0IHN5bmMgdG8gYW55dGhpbmcsIHNvIGl0IHdvcmtzIG5pY2VseSBmb3IgbWVtb3J5LW9ubHkgZmlsZXMuXG4gKi9cbmV4cG9ydCBjbGFzcyBOb1N5bmNGaWxlPFQgZXh0ZW5kcyBmaWxlX3N5c3RlbS5GaWxlU3lzdGVtPiBleHRlbmRzIFByZWxvYWRGaWxlPFQ+IGltcGxlbWVudHMgZmlsZS5GaWxlIHtcbiAgY29uc3RydWN0b3IoX2ZzOiBULCBfcGF0aDogc3RyaW5nLCBfZmxhZzogRmlsZUZsYWcsIF9zdGF0OiBTdGF0cywgY29udGVudHM/OiBOb2RlQnVmZmVyKSB7XG4gICAgc3VwZXIoX2ZzLCBfcGF0aCwgX2ZsYWcsIF9zdGF0LCBjb250ZW50cyk7XG4gIH1cbiAgLyoqXG4gICAqIEFzeW5jaHJvbm91cyBzeW5jLiBEb2Vzbid0IGRvIGFueXRoaW5nLCBzaW1wbHkgY2FsbHMgdGhlIGNiLlxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvcildIGNiXG4gICAqL1xuICBwdWJsaWMgc3luYyhjYjogKGU/OiBBcGlFcnJvcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIGNiKCk7XG4gIH1cbiAgLyoqXG4gICAqIFN5bmNocm9ub3VzIHN5bmMuIERvZXNuJ3QgZG8gYW55dGhpbmcuXG4gICAqL1xuICBwdWJsaWMgc3luY1N5bmMoKTogdm9pZCB7fVxuICAvKipcbiAgICogQXN5bmNocm9ub3VzIGNsb3NlLiBEb2Vzbid0IGRvIGFueXRoaW5nLCBzaW1wbHkgY2FsbHMgdGhlIGNiLlxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvcildIGNiXG4gICAqL1xuICBwdWJsaWMgY2xvc2UoY2I6IChlPzogQXBpRXJyb3IpID0+IHZvaWQpOiB2b2lkIHtcbiAgICBjYigpO1xuICB9XG4gIC8qKlxuICAgKiBTeW5jaHJvbm91cyBjbG9zZS4gRG9lc24ndCBkbyBhbnl0aGluZy5cbiAgICovXG4gIHB1YmxpYyBjbG9zZVN5bmMoKTogdm9pZCB7fVxufVxuIl19