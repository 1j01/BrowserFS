var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var file = require('../core/file');
var api_error_1 = require('../core/api_error');
var fs = require('../core/node_fs');
var PreloadFile = (function (_super) {
    __extends(PreloadFile, _super);
    function PreloadFile(_fs, _path, _flag, _stat, contents) {
        _super.call(this);
        this._pos = 0;
        this._dirty = false;
        this._fs = _fs;
        this._path = _path;
        this._flag = _flag;
        this._stat = _stat;
        if (contents != null) {
            this._buffer = contents;
        }
        else {
            this._buffer = new Buffer(0);
        }
        if (this._stat.size !== this._buffer.length && this._flag.isReadable()) {
            throw new Error("Invalid buffer: Buffer is " + this._buffer.length + " long, yet Stats object specifies that file is " + this._stat.size + " long.");
        }
    }
    PreloadFile.prototype.isDirty = function () {
        return this._dirty;
    };
    PreloadFile.prototype.resetDirty = function () {
        this._dirty = false;
    };
    PreloadFile.prototype.getBuffer = function () {
        return this._buffer;
    };
    PreloadFile.prototype.getStats = function () {
        return this._stat;
    };
    PreloadFile.prototype.getFlag = function () {
        return this._flag;
    };
    PreloadFile.prototype.getPath = function () {
        return this._path;
    };
    PreloadFile.prototype.getPos = function () {
        if (this._flag.isAppendable()) {
            return this._stat.size;
        }
        return this._pos;
    };
    PreloadFile.prototype.advancePos = function (delta) {
        return this._pos += delta;
    };
    PreloadFile.prototype.setPos = function (newPos) {
        return this._pos = newPos;
    };
    PreloadFile.prototype.sync = function (cb) {
        try {
            this.syncSync();
            cb();
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.syncSync = function () {
        throw new api_error_1.ApiError(api_error_1.ErrorCode.ENOTSUP);
    };
    PreloadFile.prototype.close = function (cb) {
        try {
            this.closeSync();
            cb();
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.closeSync = function () {
        throw new api_error_1.ApiError(api_error_1.ErrorCode.ENOTSUP);
    };
    PreloadFile.prototype.stat = function (cb) {
        try {
            cb(null, this._stat.clone());
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.statSync = function () {
        return this._stat.clone();
    };
    PreloadFile.prototype.truncate = function (len, cb) {
        try {
            this.truncateSync(len);
            if (this._flag.isSynchronous() && !fs.getRootFS().supportsSynch()) {
                this.sync(cb);
            }
            cb();
        }
        catch (e) {
            return cb(e);
        }
    };
    PreloadFile.prototype.truncateSync = function (len) {
        this._dirty = true;
        if (!this._flag.isWriteable()) {
            throw new api_error_1.ApiError(api_error_1.ErrorCode.EPERM, 'File not opened with a writeable mode.');
        }
        this._stat.mtime = new Date();
        if (len > this._buffer.length) {
            var buf = new Buffer(len - this._buffer.length);
            buf.fill(0);
            this.writeSync(buf, 0, buf.length, this._buffer.length);
            if (this._flag.isSynchronous() && fs.getRootFS().supportsSynch()) {
                this.syncSync();
            }
            return;
        }
        this._stat.size = len;
        var newBuff = new Buffer(len);
        this._buffer.copy(newBuff, 0, 0, len);
        this._buffer = newBuff;
        if (this._flag.isSynchronous() && fs.getRootFS().supportsSynch()) {
            this.syncSync();
        }
    };
    PreloadFile.prototype.write = function (buffer, offset, length, position, cb) {
        try {
            cb(null, this.writeSync(buffer, offset, length, position), buffer);
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.writeSync = function (buffer, offset, length, position) {
        this._dirty = true;
        if (position == null) {
            position = this.getPos();
        }
        if (!this._flag.isWriteable()) {
            throw new api_error_1.ApiError(api_error_1.ErrorCode.EPERM, 'File not opened with a writeable mode.');
        }
        var endFp = position + length;
        if (endFp > this._stat.size) {
            this._stat.size = endFp;
            if (endFp > this._buffer.length) {
                var newBuff = new Buffer(endFp);
                this._buffer.copy(newBuff);
                this._buffer = newBuff;
            }
        }
        var len = buffer.copy(this._buffer, position, offset, offset + length);
        this._stat.mtime = new Date();
        if (this._flag.isSynchronous()) {
            this.syncSync();
            return len;
        }
        this.setPos(position + len);
        return len;
    };
    PreloadFile.prototype.read = function (buffer, offset, length, position, cb) {
        try {
            cb(null, this.readSync(buffer, offset, length, position), buffer);
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.readSync = function (buffer, offset, length, position) {
        if (!this._flag.isReadable()) {
            throw new api_error_1.ApiError(api_error_1.ErrorCode.EPERM, 'File not opened with a readable mode.');
        }
        if (position == null) {
            position = this.getPos();
        }
        var endRead = position + length;
        if (endRead > this._stat.size) {
            length = this._stat.size - position;
        }
        var rv = this._buffer.copy(buffer, offset, position, position + length);
        this._stat.atime = new Date();
        this._pos = position + length;
        return rv;
    };
    PreloadFile.prototype.chmod = function (mode, cb) {
        try {
            this.chmodSync(mode);
            cb();
        }
        catch (e) {
            cb(e);
        }
    };
    PreloadFile.prototype.chmodSync = function (mode) {
        if (!this._fs.supportsProps()) {
            throw new api_error_1.ApiError(api_error_1.ErrorCode.ENOTSUP);
        }
        this._dirty = true;
        this._stat.chmod(mode);
        this.syncSync();
    };
    return PreloadFile;
})(file.BaseFile);
exports.PreloadFile = PreloadFile;
var NoSyncFile = (function (_super) {
    __extends(NoSyncFile, _super);
    function NoSyncFile(_fs, _path, _flag, _stat, contents) {
        _super.call(this, _fs, _path, _flag, _stat, contents);
    }
    NoSyncFile.prototype.sync = function (cb) {
        cb();
    };
    NoSyncFile.prototype.syncSync = function () { };
    NoSyncFile.prototype.close = function (cb) {
        cb();
    };
    NoSyncFile.prototype.closeSync = function () { };
    return NoSyncFile;
})(PreloadFile);
exports.NoSyncFile = NoSyncFile;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicHJlbG9hZF9maWxlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2dlbmVyaWMvcHJlbG9hZF9maWxlLnRzIl0sIm5hbWVzIjpbIlByZWxvYWRGaWxlIiwiUHJlbG9hZEZpbGUuY29uc3RydWN0b3IiLCJQcmVsb2FkRmlsZS5pc0RpcnR5IiwiUHJlbG9hZEZpbGUucmVzZXREaXJ0eSIsIlByZWxvYWRGaWxlLmdldEJ1ZmZlciIsIlByZWxvYWRGaWxlLmdldFN0YXRzIiwiUHJlbG9hZEZpbGUuZ2V0RmxhZyIsIlByZWxvYWRGaWxlLmdldFBhdGgiLCJQcmVsb2FkRmlsZS5nZXRQb3MiLCJQcmVsb2FkRmlsZS5hZHZhbmNlUG9zIiwiUHJlbG9hZEZpbGUuc2V0UG9zIiwiUHJlbG9hZEZpbGUuc3luYyIsIlByZWxvYWRGaWxlLnN5bmNTeW5jIiwiUHJlbG9hZEZpbGUuY2xvc2UiLCJQcmVsb2FkRmlsZS5jbG9zZVN5bmMiLCJQcmVsb2FkRmlsZS5zdGF0IiwiUHJlbG9hZEZpbGUuc3RhdFN5bmMiLCJQcmVsb2FkRmlsZS50cnVuY2F0ZSIsIlByZWxvYWRGaWxlLnRydW5jYXRlU3luYyIsIlByZWxvYWRGaWxlLndyaXRlIiwiUHJlbG9hZEZpbGUud3JpdGVTeW5jIiwiUHJlbG9hZEZpbGUucmVhZCIsIlByZWxvYWRGaWxlLnJlYWRTeW5jIiwiUHJlbG9hZEZpbGUuY2htb2QiLCJQcmVsb2FkRmlsZS5jaG1vZFN5bmMiLCJOb1N5bmNGaWxlIiwiTm9TeW5jRmlsZS5jb25zdHJ1Y3RvciIsIk5vU3luY0ZpbGUuc3luYyIsIk5vU3luY0ZpbGUuc3luY1N5bmMiLCJOb1N5bmNGaWxlLmNsb3NlIiwiTm9TeW5jRmlsZS5jbG9zZVN5bmMiXSwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsSUFBTyxJQUFJLFdBQVcsY0FBYyxDQUFDLENBQUM7QUFJdEMsMEJBQWtDLG1CQUFtQixDQUFDLENBQUE7QUFDdEQsSUFBTyxFQUFFLFdBQVcsaUJBQWlCLENB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QUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM5QkEsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDaERBLEdBQUdBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBRVpBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1lBQ3hEQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxhQUFhQSxFQUFFQSxJQUFJQSxFQUFFQSxDQUFDQSxTQUFTQSxFQUFFQSxDQUFDQSxhQUFhQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDakVBLElBQUlBLENBQUNBLFFBQVFBLEVBQUVBLENBQUNBO1lBQ2xCQSxDQUFDQTtZQUNEQSxNQUFNQSxDQUFDQTtRQUNUQSxDQUFDQTtRQUNEQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxJQUFJQSxHQUFHQSxHQUFHQSxDQUFDQTtRQUV0QkEsSUFBSUEsT0FBT0EsR0FBR0EsSUFBSUEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7UUFDOUJBLElBQUlBLENBQUNBLE9BQU9BLENBQUNBLElBQUlBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO1FBQ3RDQSxJQUFJQSxDQUFDQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQTtRQUN2QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsYUFBYUEsRUFBRUEsSUFBSUEsRUFBRUEsQ0FBQ0EsU0FBU0EsRUFBRUEsQ0FBQ0EsYUFBYUEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDakVBLElBQUlBLENB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SUFBSSxDQUFDLFFBQVEsRUF1Vy9FO0FBdldZLG1CQUFXLGNBdVd2QixDQUFBO0FBTUQ7SUFBa0V5Qiw4QkFBY0E7SUFDOUVBLG9CQUFZQSxHQUFNQSxFQUFFQSxLQUFhQSxFQUFFQSxLQUFlQSxFQUFFQSxLQUFZQSxFQUFFQSxRQUFxQkE7UUFDckZDLGtCQUFNQSxHQUFHQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQSxLQUFLQSxFQUFFQSxRQUFRQSxDQUFDQSxDQUFDQTtJQUM1Q0EsQ0FBQ0E7SUFLTUQseUJBQUlBLEdBQVhBLFVBQVlBLEVBQTBCQTtRQUNwQ0UsRUFBRUEsRUFBRUEsQ0FBQ0E7SUFDUEEsQ0FBQ0E7SUFJTUYsNkJBQVFBLEdBQWZBLGNBQXlCRyxDQUFDQTtJQUtuQkgsMEJBQUtBLEdBQVpBLFVBQWFBLEVBQTBCQTtRQUNyQ0ksRUFBRUEsRUFBRUEsQ0FBQ0E7SUFDUEEsQ0FBQ0E7SUFJTUosOEJBQVNBLEdBQWhCQSxjQUEwQkssQ0FBQ0E7SUFDN0JMLGlCQUFDQTtBQUFEQSxDQUFDQSxBQTFCRCxFQUFrRSxXQUFXLEVBMEI1RTtBQTFCWSxrQkFBVSxhQTBCdEIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmaWxlID0gcmVxdWlyZSgnLi4vY29yZS9maWxlJyk7XG5pbXBvcnQgZmlsZV9zeXN0ZW0gPSByZXF1aXJlKCcuLi9jb3JlL2ZpbGVfc3lzdGVtJyk7XG5pbXBvcnQge1N0YXRzfSBmcm9tICcuLi9jb3JlL25vZGVfZnNfc3RhdHMnO1xuaW1wb3J0IHtGaWxlRmxhZ30gZnJvbSAnLi4vY29yZS9maWxlX2ZsYWcnO1xuaW1wb3J0IHtBcGlFcnJvciwgRXJyb3JDb2RlfSBmcm9tICcuLi9jb3JlL2FwaV9lcnJvcic7XG5pbXBvcnQgZnMgPSByZXF1aXJlKCcuLi9jb3JlL25vZGVfZnMnKTtcblxuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgRmlsZSBpbnRlcmZhY2UgdGhhdCBvcGVyYXRlcyBvbiBhIGZpbGUgdGhhdCBpc1xuICogY29tcGxldGVseSBpbi1tZW1vcnkuIFByZWxvYWRGaWxlcyBhcmUgYmFja2VkIGJ5IGEgQnVmZmVyLlxuICpcbiAqIFRoaXMgaXMgYWxzbyBhbiBhYnN0cmFjdCBjbGFzcywgYXMgaXQgbGFja3MgYW4gaW1wbGVtZW50YXRpb24gb2YgJ3N5bmMnIGFuZFxuICogJ2Nsb3NlJy4gRWFjaCBmaWxlc3lzdGVtIHRoYXQgd2lzaGVzIHRvIHVzZSB0aGlzIGZpbGUgcmVwcmVzZW50YXRpb24gbXVzdFxuICogZXh0ZW5kIHRoaXMgY2xhc3MgYW5kIGltcGxlbWVudCB0aG9zZSB0d28gbWV0aG9kcy5cbiAqIEB0b2RvICdjbG9zZScgbGV2ZXIgdGhhdCBkaXNhYmxlcyBmdW5jdGlvbmFsaXR5IG9uY2UgY2xvc2VkLlxuICovXG5leHBvcnQgY2xhc3MgUHJlbG9hZEZpbGU8VCBleHRlbmRzIGZpbGVfc3lzdGVtLkZpbGVTeXN0ZW0+IGV4dGVuZHMgZmlsZS5CYXNlRmlsZSB7XG4gIHByaXZhdGUgX3BvczogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSBfcGF0aDogc3RyaW5nO1xuICBwcm90ZWN0ZWQgX2ZzOiBUO1xuICBwcml2YXRlIF9zdGF0OiBTdGF0cztcbiAgcHJpdmF0ZSBfZmxhZzogRmlsZUZsYWc7XG4gIHByaXZhdGUgX2J1ZmZlcjogTm9kZUJ1ZmZlcjtcbiAgcHJpdmF0ZSBfZGlydHk6IGJvb2xlYW4gPSBmYWxzZTtcbiAgLyoqXG4gICAqIENyZWF0ZXMgYSBmaWxlIHdpdGggdGhlIGdpdmVuIHBhdGggYW5kLCBvcHRpb25hbGx5LCB0aGUgZ2l2ZW4gY29udGVudHMuIE5vdGVcbiAgICogdGhhdCwgaWYgY29udGVudHMgaXMgc3BlY2lmaWVkLCBpdCB3aWxsIGJlIG11dGF0ZWQgYnkgdGhlIGZpbGUhXG4gICAqIEBwYXJhbSBbQnJvd3NlckZTLkZpbGVTeXN0ZW1dIF9mcyBUaGUgZmlsZSBzeXN0ZW0gdGhhdCBjcmVhdGVkIHRoZSBmaWxlLlxuICAgKiBAcGFyYW0gW1N0cmluZ10gX3BhdGhcbiAgICogQHBhcmFtIFtCcm93c2VyRlMuRmlsZU1vZGVdIF9tb2RlIFRoZSBtb2RlIHRoYXQgdGhlIGZpbGUgd2FzIG9wZW5lZCB1c2luZy5cbiAgICogICBEaWN0YXRlcyBwZXJtaXNzaW9ucyBhbmQgd2hlcmUgdGhlIGZpbGUgcG9pbnRlciBzdGFydHMuXG4gICAqIEBwYXJhbSBbQnJvd3NlckZTLm5vZGUuZnMuU3RhdHNdIF9zdGF0IFRoZSBzdGF0cyBvYmplY3QgZm9yIHRoZSBnaXZlbiBmaWxlLlxuICAgKiAgIFByZWxvYWRGaWxlIHdpbGwgbXV0YXRlIHRoaXMgb2JqZWN0LiBOb3RlIHRoYXQgdGhpcyBvYmplY3QgbXVzdCBjb250YWluXG4gICAqICAgdGhlIGFwcHJvcHJpYXRlIG1vZGUgdGhhdCB0aGUgZmlsZSB3YXMgb3BlbmVkIGFzLlxuICAgKiBAcGFyYW0gW0Jyb3dzZXJGUy5ub2RlLkJ1ZmZlcj9dIGNvbnRlbnRzIEEgYnVmZmVyIGNvbnRhaW5pbmcgdGhlIGVudGlyZVxuICAgKiAgIGNvbnRlbnRzIG9mIHRoZSBmaWxlLiBQcmVsb2FkRmlsZSB3aWxsIG11dGF0ZSB0aGlzIGJ1ZmZlci4gSWYgbm90XG4gICAqICAgc3BlY2lmaWVkLCB3ZSBhc3N1bWUgaXQgaXMgYSBuZXcgZmlsZS5cbiAgICovXG4gIGNvbnN0cnVjdG9yKF9mczogVCwgX3BhdGg6IHN0cmluZywgX2ZsYWc6IEZpbGVGbGFnLCBfc3RhdDogU3RhdHMsIGNvbnRlbnRzPzogTm9kZUJ1ZmZlcikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5fZnMgPSBfZnM7XG4gICAgdGhpcy5fcGF0aCA9IF9wYXRoO1xuICAgIHRoaXMuX2ZsYWcgPSBfZmxhZztcbiAgICB0aGlzLl9zdGF0ID0gX3N0YXQ7XG4gICAgaWYgKGNvbnRlbnRzICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX2J1ZmZlciA9IGNvbnRlbnRzO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBFbXB0eSBidWZmZXIuIEl0J2xsIGV4cGFuZCBvbmNlIHdlIHdyaXRlIHN0dWZmIHRvIGl0LlxuICAgICAgdGhpcy5fYnVmZmVyID0gbmV3IEJ1ZmZlcigwKTtcbiAgICB9XG4gICAgLy8gTm90ZTogVGhpcyBpbnZhcmlhbnQgaXMgKm5vdCogbWFpbnRhaW5lZCBvbmNlIHRoZSBmaWxlIHN0YXJ0cyBnZXR0aW5nXG4gICAgLy8gbW9kaWZpZWQuXG4gICAgLy8gTm90ZTogT25seSBhY3R1YWxseSBtYXR0ZXJzIGlmIGZpbGUgaXMgcmVhZGFibGUsIGFzIHdyaXRlYWJsZSBtb2RlcyBtYXlcbiAgICAvLyB0cnVuY2F0ZS9hcHBlbmQgdG8gZmlsZS5cbiAgICBpZiAodGhpcy5fc3RhdC5zaXplICE9PSB0aGlzLl9idWZmZXIubGVuZ3RoICYmIHRoaXMuX2ZsYWcuaXNSZWFkYWJsZSgpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbnZhbGlkIGJ1ZmZlcjogQnVmZmVyIGlzIFwiICsgdGhpcy5fYnVmZmVyLmxlbmd0aCArIFwiIGxvbmcsIHlldCBTdGF0cyBvYmplY3Qgc3BlY2lmaWVzIHRoYXQgZmlsZSBpcyBcIiArIHRoaXMuX3N0YXQuc2l6ZSArIFwiIGxvbmcuXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByb3RlY3RlZCBpc0RpcnR5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLl9kaXJ0eTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldHMgdGhlIGRpcnR5IGJpdC4gU2hvdWxkIG9ubHkgYmUgY2FsbGVkIGFmdGVyIGEgc3luYyBoYXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS5cbiAgICovXG4gIHByb3RlY3RlZCByZXNldERpcnR5KCkge1xuICAgIHRoaXMuX2RpcnR5ID0gZmFsc2U7XG4gIH1cblxuICAvKipcbiAgICogTk9OU1RBTkRBUkQ6IEdldCB0aGUgdW5kZXJseWluZyBidWZmZXIgZm9yIHRoaXMgZmlsZS4gISFETyBOT1QgTVVUQVRFISEgV2lsbCBtZXNzIHVwIGRpcnR5IHRyYWNraW5nLlxuICAgKi9cbiAgcHVibGljIGdldEJ1ZmZlcigpOiBOb2RlQnVmZmVyIHtcbiAgICByZXR1cm4gdGhpcy5fYnVmZmVyO1xuICB9XG5cbiAgLyoqXG4gICAqIE5PTlNUQU5EQVJEOiBHZXQgdW5kZXJseWluZyBzdGF0cyBmb3IgdGhpcyBmaWxlLiAhIURPIE5PVCBNVVRBVEUhIVxuICAgKi9cbiAgcHVibGljIGdldFN0YXRzKCk6IFN0YXRzIHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdDtcbiAgfVxuXG4gIHB1YmxpYyBnZXRGbGFnKCk6IEZpbGVGbGFnIHtcbiAgICByZXR1cm4gdGhpcy5fZmxhZztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIHBhdGggdG8gdGhpcyBmaWxlLlxuICAgKiBAcmV0dXJuIFtTdHJpbmddIFRoZSBwYXRoIHRvIHRoZSBmaWxlLlxuICAgKi9cbiAgcHVibGljIGdldFBhdGgoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5fcGF0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgZmlsZSBwb3NpdGlvbi5cbiAgICpcbiAgICogV2UgZW11bGF0ZSB0aGUgZm9sbG93aW5nIGJ1ZyBtZW50aW9uZWQgaW4gdGhlIE5vZGUgZG9jdW1lbnRhdGlvbjpcbiAgICogPiBPbiBMaW51eCwgcG9zaXRpb25hbCB3cml0ZXMgZG9uJ3Qgd29yayB3aGVuIHRoZSBmaWxlIGlzIG9wZW5lZCBpbiBhcHBlbmRcbiAgICogICBtb2RlLiBUaGUga2VybmVsIGlnbm9yZXMgdGhlIHBvc2l0aW9uIGFyZ3VtZW50IGFuZCBhbHdheXMgYXBwZW5kcyB0aGUgZGF0YVxuICAgKiAgIHRvIHRoZSBlbmQgb2YgdGhlIGZpbGUuXG4gICAqIEByZXR1cm4gW051bWJlcl0gVGhlIGN1cnJlbnQgZmlsZSBwb3NpdGlvbi5cbiAgICovXG4gIHB1YmxpYyBnZXRQb3MoKTogbnVtYmVyIHtcbiAgICBpZiAodGhpcy5fZmxhZy5pc0FwcGVuZGFibGUoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX3N0YXQuc2l6ZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3BvcztcbiAgfVxuXG4gIC8qKlxuICAgKiBBZHZhbmNlIHRoZSBjdXJyZW50IGZpbGUgcG9zaXRpb24gYnkgdGhlIGluZGljYXRlZCBudW1iZXIgb2YgcG9zaXRpb25zLlxuICAgKiBAcGFyYW0gW051bWJlcl0gZGVsdGFcbiAgICovXG4gIHB1YmxpYyBhZHZhbmNlUG9zKGRlbHRhOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9wb3MgKz0gZGVsdGE7XG4gIH1cblxuICAvKipcbiAgICogU2V0IHRoZSBmaWxlIHBvc2l0aW9uLlxuICAgKiBAcGFyYW0gW051bWJlcl0gbmV3UG9zXG4gICAqL1xuICBwdWJsaWMgc2V0UG9zKG5ld1BvczogbnVtYmVyKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fcG9zID0gbmV3UG9zO1xuICB9XG5cbiAgLyoqXG4gICAqICoqQ29yZSoqOiBBc3luY2hyb25vdXMgc3luYy4gTXVzdCBiZSBpbXBsZW1lbnRlZCBieSBzdWJjbGFzc2VzIG9mIHRoaXNcbiAgICogY2xhc3MuXG4gICAqIEBwYXJhbSBbRnVuY3Rpb24oQnJvd3NlckZTLkFwaUVycm9yKV0gY2JcbiAgICovXG4gIHB1YmxpYyBzeW5jKGNiOiAoZT86IEFwaUVycm9yKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMuc3luY1N5bmMoKTtcbiAgICAgIGNiKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY2IoZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqICoqQ29yZSoqOiBTeW5jaHJvbm91cyBzeW5jLlxuICAgKi9cbiAgcHVibGljIHN5bmNTeW5jKCk6IHZvaWQge1xuICAgIHRocm93IG5ldyBBcGlFcnJvcihFcnJvckNvZGUuRU5PVFNVUCk7XG4gIH1cblxuICAvKipcbiAgICogKipDb3JlKio6IEFzeW5jaHJvbm91cyBjbG9zZS4gTXVzdCBiZSBpbXBsZW1lbnRlZCBieSBzdWJjbGFzc2VzIG9mIHRoaXNcbiAgICogY2xhc3MuXG4gICAqIEBwYXJhbSBbRnVuY3Rpb24oQnJvd3NlckZTLkFwaUVycm9yKV0gY2JcbiAgICovXG4gIHB1YmxpYyBjbG9zZShjYjogKGU/OiBBcGlFcnJvcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmNsb3NlU3luYygpO1xuICAgICAgY2IoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjYihlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogKipDb3JlKio6IFN5bmNocm9ub3VzIGNsb3NlLlxuICAgKi9cbiAgcHVibGljIGNsb3NlU3luYygpOiB2b2lkIHtcbiAgICB0aHJvdyBuZXcgQXBpRXJyb3IoRXJyb3JDb2RlLkVOT1RTVVApO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzeW5jaHJvbm91cyBgc3RhdGAuXG4gICAqIEBwYXJhbSBbRnVuY3Rpb24oQnJvd3NlckZTLkFwaUVycm9yLCBCcm93c2VyRlMubm9kZS5mcy5TdGF0cyldIGNiXG4gICAqL1xuICBwdWJsaWMgc3RhdChjYjogKGU6IEFwaUVycm9yLCBzdGF0PzogU3RhdHMpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY2IobnVsbCwgdGhpcy5fc3RhdC5jbG9uZSgpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjYihlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU3luY2hyb25vdXMgYHN0YXRgLlxuICAgKi9cbiAgcHVibGljIHN0YXRTeW5jKCk6IFN0YXRzIHtcbiAgICByZXR1cm4gdGhpcy5fc3RhdC5jbG9uZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzeW5jaHJvbm91cyB0cnVuY2F0ZS5cbiAgICogQHBhcmFtIFtOdW1iZXJdIGxlblxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvcildIGNiXG4gICAqL1xuICBwdWJsaWMgdHJ1bmNhdGUobGVuOiBudW1iZXIsIGNiOiAoZT86IEFwaUVycm9yKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIHRoaXMudHJ1bmNhdGVTeW5jKGxlbik7XG4gICAgICBpZiAodGhpcy5fZmxhZy5pc1N5bmNocm9ub3VzKCkgJiYgIWZzLmdldFJvb3RGUygpLnN1cHBvcnRzU3luY2goKSkge1xuICAgICAgICB0aGlzLnN5bmMoY2IpO1xuICAgICAgfVxuICAgICAgY2IoKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4gY2IoZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN5bmNocm9ub3VzIHRydW5jYXRlLlxuICAgKiBAcGFyYW0gW051bWJlcl0gbGVuXG4gICAqL1xuICBwdWJsaWMgdHJ1bmNhdGVTeW5jKGxlbjogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5fZGlydHkgPSB0cnVlO1xuICAgIGlmICghdGhpcy5fZmxhZy5pc1dyaXRlYWJsZSgpKSB7XG4gICAgICB0aHJvdyBuZXcgQXBpRXJyb3IoRXJyb3JDb2RlLkVQRVJNLCAnRmlsZSBub3Qgb3BlbmVkIHdpdGggYSB3cml0ZWFibGUgbW9kZS4nKTtcbiAgICB9XG4gICAgdGhpcy5fc3RhdC5tdGltZSA9IG5ldyBEYXRlKCk7XG4gICAgaWYgKGxlbiA+IHRoaXMuX2J1ZmZlci5sZW5ndGgpIHtcbiAgICAgIHZhciBidWYgPSBuZXcgQnVmZmVyKGxlbiAtIHRoaXMuX2J1ZmZlci5sZW5ndGgpO1xuICAgICAgYnVmLmZpbGwoMCk7XG4gICAgICAvLyBXcml0ZSB3aWxsIHNldCBAX3N0YXQuc2l6ZSBmb3IgdXMuXG4gICAgICB0aGlzLndyaXRlU3luYyhidWYsIDAsIGJ1Zi5sZW5ndGgsIHRoaXMuX2J1ZmZlci5sZW5ndGgpO1xuICAgICAgaWYgKHRoaXMuX2ZsYWcuaXNTeW5jaHJvbm91cygpICYmIGZzLmdldFJvb3RGUygpLnN1cHBvcnRzU3luY2goKSkge1xuICAgICAgICB0aGlzLnN5bmNTeW5jKCk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX3N0YXQuc2l6ZSA9IGxlbjtcbiAgICAvLyBUcnVuY2F0ZSBidWZmZXIgdG8gJ2xlbicuXG4gICAgdmFyIG5ld0J1ZmYgPSBuZXcgQnVmZmVyKGxlbik7XG4gICAgdGhpcy5fYnVmZmVyLmNvcHkobmV3QnVmZiwgMCwgMCwgbGVuKTtcbiAgICB0aGlzLl9idWZmZXIgPSBuZXdCdWZmO1xuICAgIGlmICh0aGlzLl9mbGFnLmlzU3luY2hyb25vdXMoKSAmJiBmcy5nZXRSb290RlMoKS5zdXBwb3J0c1N5bmNoKCkpIHtcbiAgICAgIHRoaXMuc3luY1N5bmMoKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogV3JpdGUgYnVmZmVyIHRvIHRoZSBmaWxlLlxuICAgKiBOb3RlIHRoYXQgaXQgaXMgdW5zYWZlIHRvIHVzZSBmcy53cml0ZSBtdWx0aXBsZSB0aW1lcyBvbiB0aGUgc2FtZSBmaWxlXG4gICAqIHdpdGhvdXQgd2FpdGluZyBmb3IgdGhlIGNhbGxiYWNrLlxuICAgKiBAcGFyYW0gW0Jyb3dzZXJGUy5ub2RlLkJ1ZmZlcl0gYnVmZmVyIEJ1ZmZlciBjb250YWluaW5nIHRoZSBkYXRhIHRvIHdyaXRlIHRvXG4gICAqICB0aGUgZmlsZS5cbiAgICogQHBhcmFtIFtOdW1iZXJdIG9mZnNldCBPZmZzZXQgaW4gdGhlIGJ1ZmZlciB0byBzdGFydCByZWFkaW5nIGRhdGEgZnJvbS5cbiAgICogQHBhcmFtIFtOdW1iZXJdIGxlbmd0aCBUaGUgYW1vdW50IG9mIGJ5dGVzIHRvIHdyaXRlIHRvIHRoZSBmaWxlLlxuICAgKiBAcGFyYW0gW051bWJlcl0gcG9zaXRpb24gT2Zmc2V0IGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgZmlsZSB3aGVyZSB0aGlzXG4gICAqICAgZGF0YSBzaG91bGQgYmUgd3JpdHRlbi4gSWYgcG9zaXRpb24gaXMgbnVsbCwgdGhlIGRhdGEgd2lsbCBiZSB3cml0dGVuIGF0XG4gICAqICAgdGhlIGN1cnJlbnQgcG9zaXRpb24uXG4gICAqIEBwYXJhbSBbRnVuY3Rpb24oQnJvd3NlckZTLkFwaUVycm9yLCBOdW1iZXIsIEJyb3dzZXJGUy5ub2RlLkJ1ZmZlcildXG4gICAqICAgY2IgVGhlIG51bWJlciBzcGVjaWZpZXMgdGhlIG51bWJlciBvZiBieXRlcyB3cml0dGVuIGludG8gdGhlIGZpbGUuXG4gICAqL1xuICBwdWJsaWMgd3JpdGUoYnVmZmVyOiBOb2RlQnVmZmVyLCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXIsIGNiOiAoZTogQXBpRXJyb3IsIGxlbj86IG51bWJlciwgYnVmZj86IE5vZGVCdWZmZXIpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY2IobnVsbCwgdGhpcy53cml0ZVN5bmMoYnVmZmVyLCBvZmZzZXQsIGxlbmd0aCwgcG9zaXRpb24pLCBidWZmZXIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNiKGUpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBXcml0ZSBidWZmZXIgdG8gdGhlIGZpbGUuXG4gICAqIE5vdGUgdGhhdCBpdCBpcyB1bnNhZmUgdG8gdXNlIGZzLndyaXRlU3luYyBtdWx0aXBsZSB0aW1lcyBvbiB0aGUgc2FtZSBmaWxlXG4gICAqIHdpdGhvdXQgd2FpdGluZyBmb3IgdGhlIGNhbGxiYWNrLlxuICAgKiBAcGFyYW0gW0Jyb3dzZXJGUy5ub2RlLkJ1ZmZlcl0gYnVmZmVyIEJ1ZmZlciBjb250YWluaW5nIHRoZSBkYXRhIHRvIHdyaXRlIHRvXG4gICAqICB0aGUgZmlsZS5cbiAgICogQHBhcmFtIFtOdW1iZXJdIG9mZnNldCBPZmZzZXQgaW4gdGhlIGJ1ZmZlciB0byBzdGFydCByZWFkaW5nIGRhdGEgZnJvbS5cbiAgICogQHBhcmFtIFtOdW1iZXJdIGxlbmd0aCBUaGUgYW1vdW50IG9mIGJ5dGVzIHRvIHdyaXRlIHRvIHRoZSBmaWxlLlxuICAgKiBAcGFyYW0gW051bWJlcl0gcG9zaXRpb24gT2Zmc2V0IGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgZmlsZSB3aGVyZSB0aGlzXG4gICAqICAgZGF0YSBzaG91bGQgYmUgd3JpdHRlbi4gSWYgcG9zaXRpb24gaXMgbnVsbCwgdGhlIGRhdGEgd2lsbCBiZSB3cml0dGVuIGF0XG4gICAqICAgdGhlIGN1cnJlbnQgcG9zaXRpb24uXG4gICAqIEByZXR1cm4gW051bWJlcl1cbiAgICovXG4gIHB1YmxpYyB3cml0ZVN5bmMoYnVmZmVyOiBOb2RlQnVmZmVyLCBvZmZzZXQ6IG51bWJlciwgbGVuZ3RoOiBudW1iZXIsIHBvc2l0aW9uOiBudW1iZXIpOiBudW1iZXIge1xuICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcbiAgICBpZiAocG9zaXRpb24gPT0gbnVsbCkge1xuICAgICAgcG9zaXRpb24gPSB0aGlzLmdldFBvcygpO1xuICAgIH1cbiAgICBpZiAoIXRoaXMuX2ZsYWcuaXNXcml0ZWFibGUoKSkge1xuICAgICAgdGhyb3cgbmV3IEFwaUVycm9yKEVycm9yQ29kZS5FUEVSTSwgJ0ZpbGUgbm90IG9wZW5lZCB3aXRoIGEgd3JpdGVhYmxlIG1vZGUuJyk7XG4gICAgfVxuICAgIHZhciBlbmRGcCA9IHBvc2l0aW9uICsgbGVuZ3RoO1xuICAgIGlmIChlbmRGcCA+IHRoaXMuX3N0YXQuc2l6ZSkge1xuICAgICAgdGhpcy5fc3RhdC5zaXplID0gZW5kRnA7XG4gICAgICBpZiAoZW5kRnAgPiB0aGlzLl9idWZmZXIubGVuZ3RoKSB7XG4gICAgICAgIC8vIEV4dGVuZCB0aGUgYnVmZmVyIVxuICAgICAgICB2YXIgbmV3QnVmZiA9IG5ldyBCdWZmZXIoZW5kRnApO1xuICAgICAgICB0aGlzLl9idWZmZXIuY29weShuZXdCdWZmKTtcbiAgICAgICAgdGhpcy5fYnVmZmVyID0gbmV3QnVmZjtcbiAgICAgIH1cbiAgICB9XG4gICAgdmFyIGxlbiA9IGJ1ZmZlci5jb3B5KHRoaXMuX2J1ZmZlciwgcG9zaXRpb24sIG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTtcbiAgICB0aGlzLl9zdGF0Lm10aW1lID0gbmV3IERhdGUoKTtcbiAgICBpZiAodGhpcy5fZmxhZy5pc1N5bmNocm9ub3VzKCkpIHtcbiAgICAgIHRoaXMuc3luY1N5bmMoKTtcbiAgICAgIHJldHVybiBsZW47XG4gICAgfVxuICAgIHRoaXMuc2V0UG9zKHBvc2l0aW9uICsgbGVuKTtcbiAgICByZXR1cm4gbGVuO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlYWQgZGF0YSBmcm9tIHRoZSBmaWxlLlxuICAgKiBAcGFyYW0gW0Jyb3dzZXJGUy5ub2RlLkJ1ZmZlcl0gYnVmZmVyIFRoZSBidWZmZXIgdGhhdCB0aGUgZGF0YSB3aWxsIGJlXG4gICAqICAgd3JpdHRlbiB0by5cbiAgICogQHBhcmFtIFtOdW1iZXJdIG9mZnNldCBUaGUgb2Zmc2V0IHdpdGhpbiB0aGUgYnVmZmVyIHdoZXJlIHdyaXRpbmcgd2lsbFxuICAgKiAgIHN0YXJ0LlxuICAgKiBAcGFyYW0gW051bWJlcl0gbGVuZ3RoIEFuIGludGVnZXIgc3BlY2lmeWluZyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHRvIHJlYWQuXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBwb3NpdGlvbiBBbiBpbnRlZ2VyIHNwZWNpZnlpbmcgd2hlcmUgdG8gYmVnaW4gcmVhZGluZyBmcm9tXG4gICAqICAgaW4gdGhlIGZpbGUuIElmIHBvc2l0aW9uIGlzIG51bGwsIGRhdGEgd2lsbCBiZSByZWFkIGZyb20gdGhlIGN1cnJlbnQgZmlsZVxuICAgKiAgIHBvc2l0aW9uLlxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvciwgTnVtYmVyLCBCcm93c2VyRlMubm9kZS5CdWZmZXIpXSBjYiBUaGVcbiAgICogICBudW1iZXIgaXMgdGhlIG51bWJlciBvZiBieXRlcyByZWFkXG4gICAqL1xuICBwdWJsaWMgcmVhZChidWZmZXI6IE5vZGVCdWZmZXIsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgcG9zaXRpb246IG51bWJlciwgY2I6IChlOiBBcGlFcnJvciwgbGVuPzogbnVtYmVyLCBidWZmPzogTm9kZUJ1ZmZlcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjYihudWxsLCB0aGlzLnJlYWRTeW5jKGJ1ZmZlciwgb2Zmc2V0LCBsZW5ndGgsIHBvc2l0aW9uKSwgYnVmZmVyKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICBjYihlKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVhZCBkYXRhIGZyb20gdGhlIGZpbGUuXG4gICAqIEBwYXJhbSBbQnJvd3NlckZTLm5vZGUuQnVmZmVyXSBidWZmZXIgVGhlIGJ1ZmZlciB0aGF0IHRoZSBkYXRhIHdpbGwgYmVcbiAgICogICB3cml0dGVuIHRvLlxuICAgKiBAcGFyYW0gW051bWJlcl0gb2Zmc2V0IFRoZSBvZmZzZXQgd2l0aGluIHRoZSBidWZmZXIgd2hlcmUgd3JpdGluZyB3aWxsXG4gICAqICAgc3RhcnQuXG4gICAqIEBwYXJhbSBbTnVtYmVyXSBsZW5ndGggQW4gaW50ZWdlciBzcGVjaWZ5aW5nIHRoZSBudW1iZXIgb2YgYnl0ZXMgdG8gcmVhZC5cbiAgICogQHBhcmFtIFtOdW1iZXJdIHBvc2l0aW9uIEFuIGludGVnZXIgc3BlY2lmeWluZyB3aGVyZSB0byBiZWdpbiByZWFkaW5nIGZyb21cbiAgICogICBpbiB0aGUgZmlsZS4gSWYgcG9zaXRpb24gaXMgbnVsbCwgZGF0YSB3aWxsIGJlIHJlYWQgZnJvbSB0aGUgY3VycmVudCBmaWxlXG4gICAqICAgcG9zaXRpb24uXG4gICAqIEByZXR1cm4gW051bWJlcl1cbiAgICovXG4gIHB1YmxpYyByZWFkU3luYyhidWZmZXI6IE5vZGVCdWZmZXIsIG9mZnNldDogbnVtYmVyLCBsZW5ndGg6IG51bWJlciwgcG9zaXRpb246IG51bWJlcik6IG51bWJlciB7XG4gICAgaWYgKCF0aGlzLl9mbGFnLmlzUmVhZGFibGUoKSkge1xuICAgICAgdGhyb3cgbmV3IEFwaUVycm9yKEVycm9yQ29kZS5FUEVSTSwgJ0ZpbGUgbm90IG9wZW5lZCB3aXRoIGEgcmVhZGFibGUgbW9kZS4nKTtcbiAgICB9XG4gICAgaWYgKHBvc2l0aW9uID09IG51bGwpIHtcbiAgICAgIHBvc2l0aW9uID0gdGhpcy5nZXRQb3MoKTtcbiAgICB9XG4gICAgdmFyIGVuZFJlYWQgPSBwb3NpdGlvbiArIGxlbmd0aDtcbiAgICBpZiAoZW5kUmVhZCA+IHRoaXMuX3N0YXQuc2l6ZSkge1xuICAgICAgbGVuZ3RoID0gdGhpcy5fc3RhdC5zaXplIC0gcG9zaXRpb247XG4gICAgfVxuICAgIHZhciBydiA9IHRoaXMuX2J1ZmZlci5jb3B5KGJ1ZmZlciwgb2Zmc2V0LCBwb3NpdGlvbiwgcG9zaXRpb24gKyBsZW5ndGgpO1xuICAgIHRoaXMuX3N0YXQuYXRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIHRoaXMuX3BvcyA9IHBvc2l0aW9uICsgbGVuZ3RoO1xuICAgIHJldHVybiBydjtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3luY2hyb25vdXMgYGZjaG1vZGAuXG4gICAqIEBwYXJhbSBbTnVtYmVyfFN0cmluZ10gbW9kZVxuICAgKiBAcGFyYW0gW0Z1bmN0aW9uKEJyb3dzZXJGUy5BcGlFcnJvcildIGNiXG4gICAqL1xuICBwdWJsaWMgY2htb2QobW9kZTogbnVtYmVyLCBjYjogKGU/OiBBcGlFcnJvcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICB0aGlzLmNobW9kU3luYyhtb2RlKTtcbiAgICAgIGNiKCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgY2IoZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFzeW5jaHJvbm91cyBgZmNobW9kYC5cbiAgICogQHBhcmFtIFtOdW1iZXJdIG1vZGVcbiAgICovXG4gIHB1YmxpYyBjaG1vZFN5bmMobW9kZTogbnVtYmVyKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLl9mcy5zdXBwb3J0c1Byb3BzKCkpIHtcbiAgICAgIHRocm93IG5ldyBBcGlFcnJvcihFcnJvckNvZGUuRU5PVFNVUCk7XG4gICAgfVxuICAgIHRoaXMuX2RpcnR5ID0gdHJ1ZTtcbiAgICB0aGlzLl9zdGF0LmNobW9kKG1vZGUpO1xuICAgIHRoaXMuc3luY1N5bmMoKTtcbiAgfVxufVxuXG4vKipcbiAqIEZpbGUgY2xhc3MgZm9yIHRoZSBJbk1lbW9yeSBhbmQgWEhSIGZpbGUgc3lzdGVtcy5cbiAqIERvZXNuJ3Qgc3luYyB0byBhbnl0aGluZywgc28gaXQgd29ya3MgbmljZWx5IGZvciBtZW1vcnktb25seSBmaWxlcy5cbiAqL1xuZXhwb3J0IGNsYXNzIE5vU3luY0ZpbGU8VCBleHRlbmRzIGZpbGVfc3lzdGVtLkZpbGVTeXN0ZW0+IGV4dGVuZHMgUHJlbG9hZEZpbGU8VD4gaW1wbGVtZW50cyBmaWxlLkZpbGUge1xuICBjb25zdHJ1Y3RvcihfZnM6IFQsIF9wYXRoOiBzdHJpbmcsIF9mbGFnOiBGaWxlRmxhZywgX3N0YXQ6IFN0YXRzLCBjb250ZW50cz86IE5vZGVCdWZmZXIpIHtcbiAgICBzdXBlcihfZnMsIF9wYXRoLCBfZmxhZywgX3N0YXQsIGNvbnRlbnRzKTtcbiAgfVxuICAvKipcbiAgICogQXN5bmNocm9ub3VzIHN5bmMuIERvZXNuJ3QgZG8gYW55dGhpbmcsIHNpbXBseSBjYWxscyB0aGUgY2IuXG4gICAqIEBwYXJhbSBbRnVuY3Rpb24oQnJvd3NlckZTLkFwaUVycm9yKV0gY2JcbiAgICovXG4gIHB1YmxpYyBzeW5jKGNiOiAoZT86IEFwaUVycm9yKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgY2IoKTtcbiAgfVxuICAvKipcbiAgICogU3luY2hyb25vdXMgc3luYy4gRG9lc24ndCBkbyBhbnl0aGluZy5cbiAgICovXG4gIHB1YmxpYyBzeW5jU3luYygpOiB2b2lkIHt9XG4gIC8qKlxuICAgKiBBc3luY2hyb25vdXMgY2xvc2UuIERvZXNuJ3QgZG8gYW55dGhpbmcsIHNpbXBseSBjYWxscyB0aGUgY2IuXG4gICAqIEBwYXJhbSBbRnVuY3Rpb24oQnJvd3NlckZTLkFwaUVycm9yKV0gY2JcbiAgICovXG4gIHB1YmxpYyBjbG9zZShjYjogKGU/OiBBcGlFcnJvcikgPT4gdm9pZCk6IHZvaWQge1xuICAgIGNiKCk7XG4gIH1cbiAgLyoqXG4gICAqIFN5bmNocm9ub3VzIGNsb3NlLiBEb2Vzbid0IGRvIGFueXRoaW5nLlxuICAgKi9cbiAgcHVibGljIGNsb3NlU3luYygpOiB2b2lkIHt9XG59XG4iXX0=