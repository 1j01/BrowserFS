var node_fs_stats_1 = require('../core/node_fs_stats');
var Inode = (function () {
    function Inode(id, size, mode, atime, mtime, ctime) {
        this.id = id;
        this.size = size;
        this.mode = mode;
        this.atime = atime;
        this.mtime = mtime;
        this.ctime = ctime;
    }
    Inode.prototype.toStats = function () {
        return new node_fs_stats_1.default((this.mode & 0xF000) === node_fs_stats_1.FileType.DIRECTORY ? node_fs_stats_1.FileType.DIRECTORY : node_fs_stats_1.FileType.FILE, this.size, this.mode, new Date(this.atime), new Date(this.mtime), new Date(this.ctime));
    };
    Inode.prototype.getSize = function () {
        return 30 + this.id.length;
    };
    Inode.prototype.toBuffer = function (buff) {
        if (buff === void 0) { buff = new Buffer(this.getSize()); }
        buff.writeUInt32LE(this.size, 0);
        buff.writeUInt16LE(this.mode, 4);
        buff.writeDoubleLE(this.atime, 6);
        buff.writeDoubleLE(this.mtime, 14);
        buff.writeDoubleLE(this.ctime, 22);
        buff.write(this.id, 30, this.id.length, 'ascii');
        return buff;
    };
    Inode.prototype.update = function (stats) {
        var hasChanged = false;
        if (this.size !== stats.size) {
            this.size = stats.size;
            hasChanged = true;
        }
        if (this.mode !== stats.mode) {
            this.mode = stats.mode;
            hasChanged = true;
        }
        var atimeMs = stats.atime.getTime();
        if (this.atime !== atimeMs) {
            this.atime = atimeMs;
            hasChanged = true;
        }
        var mtimeMs = stats.mtime.getTime();
        if (this.mtime !== mtimeMs) {
            this.mtime = mtimeMs;
            hasChanged = true;
        }
        var ctimeMs = stats.ctime.getTime();
        if (this.ctime !== ctimeMs) {
            this.ctime = ctimeMs;
            hasChanged = true;
        }
        return hasChanged;
    };
    Inode.fromBuffer = function (buffer) {
        if (buffer === undefined) {
            throw new Error("NO");
        }
        return new Inode(buffer.toString('ascii', 30), buffer.readUInt32LE(0), buffer.readUInt16LE(4), buffer.readDoubleLE(6), buffer.readDoubleLE(14), buffer.readDoubleLE(22));
    };
    Inode.prototype.isFile = function () {
        return (this.mode & 0xF000) === node_fs_stats_1.FileType.FILE;
    };
    Inode.prototype.isDirectory = function () {
        return (this.mode & 0xF000) === node_fs_stats_1.FileType.DIRECTORY;
    };
    return Inode;
})();
module.exports = Inode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5vZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvZ2VuZXJpYy9pbm9kZS50cyJdLCJuYW1lcyI6WyJJbm9kZSIsIklub2RlLmNvbnN0cnVjdG9yIiwiSW5vZGUudG9TdGF0cyIsIklub2RlLmdldFNpemUiLCJJbm9kZS50b0J1ZmZlciIsIklub2RlLnVwZGF0ZSIsIklub2RlLmZyb21CdWZmZXIiLCJJbm9kZS5pc0ZpbGUiLCJJbm9kZS5pc0RpcmVjdG9yeSJdLCJtYXBwaW5ncyI6IkFBQUEsOEJBQXlDLHVCQUF1QixDQUFDLENBQUE7QUFLakU7SUFDRUEsZUFBbUJBLEVBQVVBLEVBQ3BCQSxJQUFZQSxFQUNaQSxJQUFZQSxFQUNaQSxLQUFhQSxFQUNiQSxLQUFhQSxFQUNiQSxLQUFhQTtRQUxIQyxPQUFFQSxHQUFGQSxFQUFFQSxDQUFRQTtRQUNwQkEsU0FBSUEsR0FBSkEsSUFBSUEsQ0FBUUE7UUFDWkEsU0FBSUEsR0FBSkEsSUFBSUEsQ0FBUUE7UUFDWkEsVUFBS0EsR0FBTEEsS0FBS0EsQ0FBUUE7UUFDYkEsVUFBS0EsR0FBTEEsS0FBS0EsQ0FBUUE7UUFDYkEsVUFBS0EsR0FBTEEsS0FBS0EsQ0FBUUE7SUFBSUEsQ0FBQ0E7SUFLcEJELHVCQUFPQSxHQUFkQTtRQUNFRSxNQUFNQSxDQUFDQSxJQUFJQSx1QkFBS0EsQ0FDZEEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsSUFBSUEsR0FBR0EsTUFBTUEsQ0FBQ0EsS0FBS0Esd0JBQVFBLENBQUNBLFNBQVNBLEdBQUdBLHdCQUFRQSxDQUFDQSxTQUFTQSxHQUFHQSx3QkFBUUEsQ0FBQ0EsSUFBSUEsRUFDaEZBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEVBQUVBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEVBQUVBLElBQUlBLElBQUlBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBO0lBQzVGQSxDQUFDQTtJQUtNRix1QkFBT0EsR0FBZEE7UUFFRUcsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7SUFDN0JBLENBQUNBO0lBS01ILHdCQUFRQSxHQUFmQSxVQUFnQkEsSUFBNkNBO1FBQTdDSSxvQkFBNkNBLEdBQTdDQSxXQUF1QkEsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7UUFDM0RBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBO1FBQ2pDQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNqQ0EsSUFBSUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDbENBLElBQUlBLENBQUNBLGFBQWFBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO1FBQ25DQSxJQUFJQSxDQUFDQSxhQUFhQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtRQUNuQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsRUFBRUEsRUFBRUEsRUFBRUEsRUFBRUEsSUFBSUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsTUFBTUEsRUFBRUEsT0FBT0EsQ0FBQ0EsQ0FBQ0E7UUFDakRBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO0lBQ2RBLENBQUNBO0lBWU1KLHNCQUFNQSxHQUFiQSxVQUFjQSxLQUFZQTtRQUN4QkssSUFBSUEsVUFBVUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDdkJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEtBQUtBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQzdCQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUN2QkEsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDcEJBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEtBQUtBLEtBQUtBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1lBQzdCQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQTtZQUN2QkEsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDcEJBLENBQUNBO1FBRURBLElBQUlBLE9BQU9BLEdBQUdBLEtBQUtBLENBQUNBLEtBQUtBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1FBQ3BDQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxLQUFLQSxLQUFLQSxPQUFPQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUMzQkEsSUFBSUEsQ0FBQ0EsS0FBS0EsR0FBR0EsT0FBT0EsQ0FBQ0E7WUFDckJBLFVBQVVBLEdBQUdBLElBQUlBLENBQUNBO1FBQ3BCQSxDQUFDQTtRQUVEQSxJQUFJQSxPQUFPQSxHQUFHQSxLQUFLQSxDQUFDQSxLQUFLQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtRQUNwQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsS0FBS0EsT0FBT0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDM0JBLElBQUlBLENBQUNBLEtBQUtBLEdBQUdBLE9BQU9BLENBQUNBO1lBQ3JCQSxVQUFVQSxHQUFHQSxJQUFJQSxDQUFDQTtRQUNwQkEsQ0FBQ0E7UUFFREEsSUFBSUEsT0FBT0EsR0FBR0EsS0FBS0EsQ0FBQ0EsS0FBS0EsQ0FBQ0EsT0FBT0EsRUFBRUEsQ0FBQ0E7UUFDcENBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLEtBQUtBLEtBQUtBLE9BQU9BLENBQUNBLENBQUNBLENBQUNBO1lBQzNCQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxPQUFPQSxDQUFDQTtZQUNyQkEsVUFBVUEsR0FBR0EsSUFBSUEsQ0FBQ0E7UUFDcEJBLENBQUNBO1FBRURBLE1BQU1BLENBQUNBLFVBQVVBLENBQUNBO0lBQ3BCQSxDQUFDQTtJQUthTCxnQkFBVUEsR0FBeEJBLFVBQXlCQSxNQUFrQkE7UUFDekNNLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLEtBQUtBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1lBQ3pCQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUN4QkEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsSUFBSUEsS0FBS0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsT0FBT0EsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFDM0NBLE1BQU1BLENBQUNBLFlBQVlBLENBQUNBLENBQUNBLENBQUNBLEVBQ3RCQSxNQUFNQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQSxDQUFDQSxFQUN0QkEsTUFBTUEsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsRUFDdEJBLE1BQU1BLENBQUNBLFlBQVlBLENBQUNBLEVBQUVBLENBQUNBLEVBQ3ZCQSxNQUFNQSxDQUFDQSxZQUFZQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUN4QkEsQ0FBQ0E7SUFDSkEsQ0FBQ0E7SUFRTU4sc0JBQU1BLEdBQWJBO1FBQ0VPLE1BQU1BLENBQUNBLENBQUNBLElBQUlBLENBQUNBLElBQUlBLEdBQUdBLE1BQU1BLENBQUNBLEtBQUtBLHdCQUFRQSxDQUFDQSxJQUFJQSxDQUFDQTtJQUNoREEsQ0FBQ0E7SUFLTVAsMkJBQVdBLEdBQWxCQTtRQUNFUSxNQUFNQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxJQUFJQSxHQUFHQSxNQUFNQSxDQUFDQSxLQUFLQSx3QkFBUUEsQ0FBQ0EsU0FBU0EsQ0FBQ0E7SUFDckRBLENBQUNBO0lBQ0hSLFlBQUNBO0FBQURBLENBQUNBLEFBakhELElBaUhDO0FBRUQsaUJBQVMsS0FBSyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtkZWZhdWx0IGFzIFN0YXRzLCBGaWxlVHlwZX0gZnJvbSAnLi4vY29yZS9ub2RlX2ZzX3N0YXRzJztcblxuLyoqXG4gKiBHZW5lcmljIGlub2RlIGRlZmluaXRpb24gdGhhdCBjYW4gZWFzaWx5IGJlIHNlcmlhbGl6ZWQuXG4gKi9cbmNsYXNzIElub2RlIHtcbiAgY29uc3RydWN0b3IocHVibGljIGlkOiBzdHJpbmcsXG4gICAgcHVibGljIHNpemU6IG51bWJlcixcbiAgICBwdWJsaWMgbW9kZTogbnVtYmVyLFxuICAgIHB1YmxpYyBhdGltZTogbnVtYmVyLFxuICAgIHB1YmxpYyBtdGltZTogbnVtYmVyLFxuICAgIHB1YmxpYyBjdGltZTogbnVtYmVyKSB7IH1cblxuICAvKipcbiAgICogSGFuZHkgZnVuY3Rpb24gdGhhdCBjb252ZXJ0cyB0aGUgSW5vZGUgdG8gYSBOb2RlIFN0YXRzIG9iamVjdC5cbiAgICovXG4gIHB1YmxpYyB0b1N0YXRzKCk6IFN0YXRzIHtcbiAgICByZXR1cm4gbmV3IFN0YXRzKFxuICAgICAgKHRoaXMubW9kZSAmIDB4RjAwMCkgPT09IEZpbGVUeXBlLkRJUkVDVE9SWSA/IEZpbGVUeXBlLkRJUkVDVE9SWSA6IEZpbGVUeXBlLkZJTEUsXG4gICAgICB0aGlzLnNpemUsIHRoaXMubW9kZSwgbmV3IERhdGUodGhpcy5hdGltZSksIG5ldyBEYXRlKHRoaXMubXRpbWUpLCBuZXcgRGF0ZSh0aGlzLmN0aW1lKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHRoZSBzaXplIG9mIHRoaXMgSW5vZGUsIGluIGJ5dGVzLlxuICAgKi9cbiAgcHVibGljIGdldFNpemUoKTogbnVtYmVyIHtcbiAgICAvLyBBU1NVTVBUSU9OOiBJRCBpcyBBU0NJSSAoMSBieXRlIHBlciBjaGFyKS5cbiAgICByZXR1cm4gMzAgKyB0aGlzLmlkLmxlbmd0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBXcml0ZXMgdGhlIGlub2RlIGludG8gdGhlIHN0YXJ0IG9mIHRoZSBidWZmZXIuXG4gICAqL1xuICBwdWJsaWMgdG9CdWZmZXIoYnVmZjogTm9kZUJ1ZmZlciA9IG5ldyBCdWZmZXIodGhpcy5nZXRTaXplKCkpKTogTm9kZUJ1ZmZlciB7XG4gICAgYnVmZi53cml0ZVVJbnQzMkxFKHRoaXMuc2l6ZSwgMCk7XG4gICAgYnVmZi53cml0ZVVJbnQxNkxFKHRoaXMubW9kZSwgNCk7XG4gICAgYnVmZi53cml0ZURvdWJsZUxFKHRoaXMuYXRpbWUsIDYpO1xuICAgIGJ1ZmYud3JpdGVEb3VibGVMRSh0aGlzLm10aW1lLCAxNCk7XG4gICAgYnVmZi53cml0ZURvdWJsZUxFKHRoaXMuY3RpbWUsIDIyKTtcbiAgICBidWZmLndyaXRlKHRoaXMuaWQsIDMwLCB0aGlzLmlkLmxlbmd0aCwgJ2FzY2lpJyk7XG4gICAgcmV0dXJuIGJ1ZmY7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgSW5vZGUgdXNpbmcgaW5mb3JtYXRpb24gZnJvbSB0aGUgc3RhdHMgb2JqZWN0LiBVc2VkIGJ5IGZpbGVcbiAgICogc3lzdGVtcyBhdCBzeW5jIHRpbWUsIGUuZy46XG4gICAqIC0gUHJvZ3JhbSBvcGVucyBmaWxlIGFuZCBnZXRzIGEgRmlsZSBvYmplY3QuXG4gICAqIC0gUHJvZ3JhbSBtdXRhdGVzIGZpbGUuIEZpbGUgb2JqZWN0IGlzIHJlc3BvbnNpYmxlIGZvciBtYWludGFpbmluZ1xuICAgKiAgIG1ldGFkYXRhIGNoYW5nZXMgbG9jYWxseSAtLSB0eXBpY2FsbHkgaW4gYSBTdGF0cyBvYmplY3QuXG4gICAqIC0gUHJvZ3JhbSBjbG9zZXMgZmlsZS4gRmlsZSBvYmplY3QncyBtZXRhZGF0YSBjaGFuZ2VzIGFyZSBzeW5jZWQgd2l0aCB0aGVcbiAgICogICBmaWxlIHN5c3RlbS5cbiAgICogQHJldHVybiBUcnVlIGlmIGFueSBjaGFuZ2VzIGhhdmUgb2NjdXJyZWQuXG4gICAqL1xuICBwdWJsaWMgdXBkYXRlKHN0YXRzOiBTdGF0cyk6IGJvb2xlYW4ge1xuICAgIHZhciBoYXNDaGFuZ2VkID0gZmFsc2U7XG4gICAgaWYgKHRoaXMuc2l6ZSAhPT0gc3RhdHMuc2l6ZSkge1xuICAgICAgdGhpcy5zaXplID0gc3RhdHMuc2l6ZTtcbiAgICAgIGhhc0NoYW5nZWQgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmICh0aGlzLm1vZGUgIT09IHN0YXRzLm1vZGUpIHtcbiAgICAgIHRoaXMubW9kZSA9IHN0YXRzLm1vZGU7XG4gICAgICBoYXNDaGFuZ2VkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgYXRpbWVNcyA9IHN0YXRzLmF0aW1lLmdldFRpbWUoKTtcbiAgICBpZiAodGhpcy5hdGltZSAhPT0gYXRpbWVNcykge1xuICAgICAgdGhpcy5hdGltZSA9IGF0aW1lTXM7XG4gICAgICBoYXNDaGFuZ2VkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgbXRpbWVNcyA9IHN0YXRzLm10aW1lLmdldFRpbWUoKTtcbiAgICBpZiAodGhpcy5tdGltZSAhPT0gbXRpbWVNcykge1xuICAgICAgdGhpcy5tdGltZSA9IG10aW1lTXM7XG4gICAgICBoYXNDaGFuZ2VkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICB2YXIgY3RpbWVNcyA9IHN0YXRzLmN0aW1lLmdldFRpbWUoKTtcbiAgICBpZiAodGhpcy5jdGltZSAhPT0gY3RpbWVNcykge1xuICAgICAgdGhpcy5jdGltZSA9IGN0aW1lTXM7XG4gICAgICBoYXNDaGFuZ2VkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICByZXR1cm4gaGFzQ2hhbmdlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb252ZXJ0cyB0aGUgYnVmZmVyIGludG8gYW4gSW5vZGUuXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIGZyb21CdWZmZXIoYnVmZmVyOiBOb2RlQnVmZmVyKTogSW5vZGUge1xuICAgIGlmIChidWZmZXIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiTk9cIik7XG4gICAgfVxuICAgIHJldHVybiBuZXcgSW5vZGUoYnVmZmVyLnRvU3RyaW5nKCdhc2NpaScsIDMwKSxcbiAgICAgIGJ1ZmZlci5yZWFkVUludDMyTEUoMCksXG4gICAgICBidWZmZXIucmVhZFVJbnQxNkxFKDQpLFxuICAgICAgYnVmZmVyLnJlYWREb3VibGVMRSg2KSxcbiAgICAgIGJ1ZmZlci5yZWFkRG91YmxlTEUoMTQpLFxuICAgICAgYnVmZmVyLnJlYWREb3VibGVMRSgyMilcbiAgICApO1xuICB9XG5cbiAgLy8gWFhYOiBDb3BpZWQgZnJvbSBTdGF0cy4gU2hvdWxkIHJlY29uY2lsZSB0aGVzZSB0d28gaW50byBzb21ldGhpbmcgbW9yZVxuICAvLyAgICAgIGNvbXBhY3QuXG5cbiAgLyoqXG4gICAqIEByZXR1cm4gW0Jvb2xlYW5dIFRydWUgaWYgdGhpcyBpdGVtIGlzIGEgZmlsZS5cbiAgICovXG4gIHB1YmxpYyBpc0ZpbGUoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICh0aGlzLm1vZGUgJiAweEYwMDApID09PSBGaWxlVHlwZS5GSUxFO1xuICB9XG5cbiAgLyoqXG4gICAqIEByZXR1cm4gW0Jvb2xlYW5dIFRydWUgaWYgdGhpcyBpdGVtIGlzIGEgZGlyZWN0b3J5LlxuICAgKi9cbiAgcHVibGljIGlzRGlyZWN0b3J5KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAodGhpcy5tb2RlICYgMHhGMDAwKSA9PT0gRmlsZVR5cGUuRElSRUNUT1JZO1xuICB9XG59XG5cbmV4cG9ydCA9IElub2RlO1xuIl19