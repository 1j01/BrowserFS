/**
 * BrowserFS's main module. This is exposed in the browser via the BrowserFS global.
 */
var buffer = require('buffer');
var fs = require('./node_fs');
var path = require('path');
var emscripten_fs_1 = require('../generic/emscripten_fs');
exports.EmscriptenFS = emscripten_fs_1["default"];
var FileSystem = require('./backends');
exports.FileSystem = FileSystem;
function install(obj) {
    obj.Buffer = Buffer;
    obj.process = process;
    var oldRequire = obj.require != null ? obj.require : null;
    obj.require = function (arg) {
        var rv = BFSRequire(arg);
        if (rv == null) {
            return oldRequire.apply(null, Array.prototype.slice.call(arguments, 0));
        }
        else {
            return rv;
        }
    };
}
exports.install = install;
function registerFileSystem(name, fs) {
    FileSystem[name] = fs;
}
exports.registerFileSystem = registerFileSystem;
function BFSRequire(module) {
    switch (module) {
        case 'fs':
            return fs;
        case 'path':
            return path;
        case 'buffer':
            return buffer;
        case 'process':
            return process;
        default:
            return FileSystem[module];
    }
}
exports.BFSRequire = BFSRequire;
function initialize(rootfs) {
    return fs._initialize(rootfs);
}
exports.initialize = initialize;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJvd3NlcmZzLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvcmUvYnJvd3NlcmZzLnRzIl0sIm5hbWVzIjpbImluc3RhbGwiLCJyZWdpc3RlckZpbGVTeXN0ZW0iLCJCRlNSZXF1aXJlIiwiaW5pdGlhbGl6ZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0dBRUc7QUFFSCxJQUFPLE1BQU0sV0FBVyxRQUFRLENBQUMsQ0FBQztBQUNsQyxJQUFPLEVBQUUsV0FBVyxXQUFXLENBQUMsQ0FBQztBQUNqQyxJQUFPLElBQUksV0FBVyxNQUFNLENBQUMsQ0FBQztBQUU5Qiw4QkFBeUIsMEJBQTBCLENBQUMsQ0FBQTtBQThENUMsb0JBQVk7QUE3RHBCLElBQVksVUFBVSxXQUFNLFlBQVksQ0FBQyxDQUFBO0FBNkRuQixrQkFBVTtBQTdDaEMsaUJBQXdCLEdBQVE7SUFDOUJBLEdBQUdBLENBQUNBLE1BQU1BLEdBQUdBLE1BQU1BLENBQUNBO0lBQ3BCQSxHQUFHQSxDQUFDQSxPQUFPQSxHQUFHQSxPQUFPQSxDQUFDQTtJQUN0QkEsSUFBSUEsVUFBVUEsR0FBR0EsR0FBR0EsQ0FBQ0EsT0FBT0EsSUFBSUEsSUFBSUEsR0FBR0EsR0FBR0EsQ0FBQ0EsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0E7SUFFMURBLEdBQUdBLENBQUNBLE9BQU9BLEdBQUdBLFVBQVNBLEdBQVdBO1FBQ2hDLElBQUksRUFBRSxHQUFHLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN6QixFQUFFLENBQUMsQ0FBQyxFQUFFLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNmLE1BQU0sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDekUsQ0FBQztRQUFDLElBQUksQ0FBQyxDQUFDO1lBQ04sTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUNaLENBQUM7SUFDSCxDQUFDLENBQUNBO0FBQ0pBLENBQUNBO0FBYmUsZUFBTyxVQWF0QixDQUFBO0FBRUQsNEJBQW1DLElBQVksRUFBRSxFQUFxQztJQUM3RUMsVUFBV0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsRUFBRUEsQ0FBQ0E7QUFDaENBLENBQUNBO0FBRmUsMEJBQWtCLHFCQUVqQyxDQUFBO0FBRUQsb0JBQTJCLE1BQWM7SUFDdkNDLE1BQU1BLENBQUFBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1FBQ2RBLEtBQUtBLElBQUlBO1lBQ1BBLE1BQU1BLENBQUNBLEVBQUVBLENBQUNBO1FBQ1pBLEtBQUtBLE1BQU1BO1lBQ1RBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1FBQ2RBLEtBQUtBLFFBQVFBO1lBRVhBLE1BQU1BLENBQUNBLE1BQU1BLENBQUNBO1FBQ2hCQSxLQUFLQSxTQUFTQTtZQUNaQSxNQUFNQSxDQUFDQSxPQUFPQSxDQUFDQTtRQUNqQkE7WUFDRUEsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFDOUJBLENBQUNBO0FBQ0hBLENBQUNBO0FBZGUsa0JBQVUsYUFjekIsQ0FBQTtBQVFELG9CQUEyQixNQUE4QjtJQUN2REMsTUFBTUEsQ0FBQ0EsRUFBRUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7QUFDaENBLENBQUNBO0FBRmUsa0JBQVUsYUFFekIsQ0FBQTtBQUVpQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQnJvd3NlckZTJ3MgbWFpbiBtb2R1bGUuIFRoaXMgaXMgZXhwb3NlZCBpbiB0aGUgYnJvd3NlciB2aWEgdGhlIEJyb3dzZXJGUyBnbG9iYWwuXG4gKi9cblxuaW1wb3J0IGJ1ZmZlciA9IHJlcXVpcmUoJ2J1ZmZlcicpO1xuaW1wb3J0IGZzID0gcmVxdWlyZSgnLi9ub2RlX2ZzJyk7XG5pbXBvcnQgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbmltcG9ydCBmaWxlX3N5c3RlbSA9IHJlcXVpcmUoJy4vZmlsZV9zeXN0ZW0nKTtcbmltcG9ydCBFbXNjcmlwdGVuRlMgZnJvbSAnLi4vZ2VuZXJpYy9lbXNjcmlwdGVuX2ZzJztcbmltcG9ydCAqIGFzIEZpbGVTeXN0ZW0gZnJvbSAnLi9iYWNrZW5kcyc7XG5cbi8qKlxuICogSW5zdGFsbHMgQnJvd3NlckZTIG9udG8gdGhlIGdpdmVuIG9iamVjdC5cbiAqIFdlIHJlY29tbWVuZCB0aGF0IHlvdSBydW4gaW5zdGFsbCB3aXRoIHRoZSAnd2luZG93JyBvYmplY3QgdG8gbWFrZSB0aGluZ3NcbiAqIGdsb2JhbCwgYXMgaW4gTm9kZS5cbiAqXG4gKiBQcm9wZXJ0aWVzIGluc3RhbGxlZDpcbiAqXG4gKiAqIEJ1ZmZlclxuICogKiBwcm9jZXNzXG4gKiAqIHJlcXVpcmUgKHdlIG1vbmtleS1wYXRjaCBpdClcbiAqXG4gKiBUaGlzIGFsbG93cyB5b3UgdG8gd3JpdGUgY29kZSBhcyBpZiB5b3Ugd2VyZSBydW5uaW5nIGluc2lkZSBOb2RlLlxuICogQHBhcmFtIHtvYmplY3R9IG9iaiAtIFRoZSBvYmplY3QgdG8gaW5zdGFsbCB0aGluZ3Mgb250byAoZS5nLiB3aW5kb3cpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpbnN0YWxsKG9iajogYW55KSB7XG4gIG9iai5CdWZmZXIgPSBCdWZmZXI7XG4gIG9iai5wcm9jZXNzID0gcHJvY2VzcztcbiAgdmFyIG9sZFJlcXVpcmUgPSBvYmoucmVxdWlyZSAhPSBudWxsID8gb2JqLnJlcXVpcmUgOiBudWxsO1xuICAvLyBNb25rZXktcGF0Y2ggcmVxdWlyZSBmb3IgTm9kZS1zdHlsZSBjb2RlLlxuICBvYmoucmVxdWlyZSA9IGZ1bmN0aW9uKGFyZzogc3RyaW5nKSB7XG4gICAgdmFyIHJ2ID0gQkZTUmVxdWlyZShhcmcpO1xuICAgIGlmIChydiA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gb2xkUmVxdWlyZS5hcHBseShudWxsLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDApKVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcnY7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJGaWxlU3lzdGVtKG5hbWU6IHN0cmluZywgZnM6IGZpbGVfc3lzdGVtLkZpbGVTeXN0ZW1Db25zdHJ1Y3Rvcikge1xuICAoPGFueT4gRmlsZVN5c3RlbSlbbmFtZV0gPSBmcztcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIEJGU1JlcXVpcmUobW9kdWxlOiBzdHJpbmcpIHtcbiAgc3dpdGNoKG1vZHVsZSkge1xuICAgIGNhc2UgJ2ZzJzpcbiAgICAgIHJldHVybiBmcztcbiAgICBjYXNlICdwYXRoJzpcbiAgICAgIHJldHVybiBwYXRoO1xuICAgIGNhc2UgJ2J1ZmZlcic6XG4gICAgICAvLyBUaGUgJ2J1ZmZlcicgbW9kdWxlIGhhcyAnQnVmZmVyJyBhcyBhIHByb3BlcnR5LlxuICAgICAgcmV0dXJuIGJ1ZmZlcjtcbiAgICBjYXNlICdwcm9jZXNzJzpcbiAgICAgIHJldHVybiBwcm9jZXNzO1xuICAgIGRlZmF1bHQ6XG4gICAgICByZXR1cm4gRmlsZVN5c3RlbVttb2R1bGVdO1xuICB9XG59XG5cbi8qKlxuICogWW91IG11c3QgY2FsbCB0aGlzIGZ1bmN0aW9uIHdpdGggYSBwcm9wZXJseS1pbnN0YW50aWF0ZWQgcm9vdCBmaWxlIHN5c3RlbVxuICogYmVmb3JlIHVzaW5nIGFueSBmaWxlIHN5c3RlbSBBUEkgbWV0aG9kLlxuICogQHBhcmFtIHtCcm93c2VyRlMuRmlsZVN5c3RlbX0gcm9vdEZTIC0gVGhlIHJvb3QgZmlsZXN5c3RlbSB0byB1c2UgZm9yIHRoZVxuICogICBlbnRpcmUgQnJvd3NlckZTIGZpbGUgc3lzdGVtLlxuICovXG5leHBvcnQgZnVuY3Rpb24gaW5pdGlhbGl6ZShyb290ZnM6IGZpbGVfc3lzdGVtLkZpbGVTeXN0ZW0pIHtcbiAgcmV0dXJuIGZzLl9pbml0aWFsaXplKHJvb3Rmcyk7XG59XG5cbmV4cG9ydCB7RW1zY3JpcHRlbkZTLCBGaWxlU3lzdGVtfTtcbiJdfQ==